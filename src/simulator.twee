:: StoryTitle
simulator


:: StoryData
{
  "ifid": "f2594c19-2b1a-436c-a749-c92e439252f0",
  "format": "SugarCube",
  "format-version": "2.37.3",
  "start": "Start",
  "zoom": 1
}


:: Bill 1 {"position":"325,500","size":"100,100"}
<<script>>
PolicyManager.register({
  name: "Emergency Shelter Expansion",
  costUpfront: 10,
  costPerTurn: 0,
  duration: 3, // heavy up-front push

  immediate(v) {
    v.unsheltered        -= 500;
    v.sheltered        += 500;
    v.staffMorale        -= 10;
    v.publicOpinion      += 1;
  },

  tick(v, Util, age) {
    // One-quarter later, about 30% return
    if (age === 2) {
      const reenter = Math.round(500 * 0.3);
      v.sheltered        -= reenter;
      v.unsheltered += reenter;
      v.homelessTotal += reenter;
    }
  }
});
<</script>>

<div class="passageContent"> 
<p>You open 300 beds and clear two major encampments. The media love the “huge action,” but by Quarter 3 about 150 people have cycled back out.</p>

[[Continue|BuildCanadaHomes]]
</div>



:: Bill 2 {"position":"500,500","size":"100,100"}
<<script>>
PolicyManager.register({
  name: "Build City Affordable Housing",
  costUpfront: 10,
  duration: 999999,

  immediate(v) {
    v.publicOpinion -= 15;
    // initial setup already deducts costUpfront
  },

  tick(v, Util, age) {
    // Decreasing operational cost over time, then net revenue
    let cost = 8;

    if (age >= 2)  cost = .42;
    if (age >= 5) cost = .12;
    if (age >= 7) cost = -.5; // begins generating surplus

    v.budget -= cost;

    // Exit people: housing units become available over time
    if (age >= 2) {
      const exits = 100 + Math.floor(25 * (age - 2)); // gradual ramp-up
      window.Util.exitPeople(exits);
    }

    // Service coordination stabilizes and improves after age 10
    if (age >= 10 && age < 30) {
      v.serviceCoordination += 2;
    }
  }
});
<</script>>

<div class="passageContent"> 
<div class="animated-box">
  <p>Building is complete</p>
</div>

[[Continue|BuildCanadaHomes]]
</div>



:: Bill 3 {"position":"700,500","size":"100,100"}
<<script>>
PolicyManager.register({
  name: "Frontline Mental Health & Addiction Support",
  costUpfront: 4,
  costPerTurn: 2,
  duration: 20,

  immediate(v) {
    v.staffMorale        += 10;
    v.unsheltered        -= 300;
    v.publicOpinion  -= 50;
    v.homelessTotal = v.unsheltered + v.sheltered + v.transitional + v.institutional;
  },

  tick(v, Util, age) {
    // Each quarter, 3% of chronic population exit through wrap-around care
    const chronicPop = v.pop.chronic;
        v.publicOpinion  += 20;
    const exits     = Math.round(chronicPop * 0.03);
    window.Util.exitPeople(exits, { chronic: 1 });
  }
});
<</script>>
<div class="passageContent"> 
<p>You fund mobile response teams and a low-barrier detox centre. ER visits drop immediately, and by year’s end the chronically homeless count is noticeably down.</p>

[[Continue|BuildCanadaHomes]]
</div>



:: Bill 4 {"position":"900,500","size":"100,100"}
<<script>>
PolicyManager.register({
  name: "Lived Experience Consultation",
  costUpfront: 10,
  costPerTurn: 2,
  duration: 20, // lasts 4 turns (1 year)

  immediate(v) {
    v.systemCoordination += 5;
    v.publicOpinion    += 15;
  },

  tick(v, Util, age) {
    // After two quarters, you start to see people move out:
    if (age >= 2) {
     v.systemCoordination += 1;
     v.publicOpinion += 1;
      const exits = Math.round(v.homelessTotal * 0.04); // 4% per quarter
      window.Util.exitPeople(exits);
    }
  }
});
<</script>>
<div class="passageContent"> 
<p>You bring together people with lived experience, service providers, and city departments for co-design. It doesn’t look flashy, but by mid-year your plans have become smarter and more targeted. </p>

[[Continue|BuildCanadaHomes]]

</div>



:: Bills {"position":"1225,175","size":"100,100"}
<<script>>
// run on *every* time this passage finishes displaying
$(document).on(':passagedisplay', function (ev) {
  // 1) inject the CSS if we haven't already
  if (!$('head').find('link[href*="swiper-bundle.min.css"]').length) {
    $('head').append(
      '<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">'
    );
  }

  // 2) helper to actually init the carousel
  function setupSwiper() {
    const el = ev.content.querySelector('.mySwiper');
    if (!el) return;
    if (window.mySwiper) {
      window.mySwiper.destroy(true, true);
    }
    // ← here’s the only change: add observer + observeParents
    window.mySwiper = new Swiper(el, {
      effect:      'cards',
      grabCursor:  true,
      observer:        true,
      observeParents:  true
    });
  }

  // 3) load Swiper.js if needed, otherwise just init
  if (typeof Swiper === 'undefined') {
    $.getScript('https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js')
     .done(setupSwiper)
     .fail(() => console.error('Failed to load Swiper.'));
  }
  else {
    setupSwiper();
  }
});
<</script>>

<div class="passageContent"> 




    <!-- Demo styles -->
    <style>

:root {
zoom: 1.1;
}
      html,
      body {
        position: relative;
        height: 100%;
      }

      body {
        background: #eee;
        font-family: Helvetica Neue, Helvetica, Arial, sans-serif;
        font-size: 14px;
        color: #000;
        margin: 0;
        padding: 0;
      }

      body {
        background: #fff;
        font-family: Helvetica Neue, Helvetica, Arial, sans-serif;
        font-size: 14px;
        color: #000;
        margin: 0;
        padding: 0;
      }

      html,
      body {
        position: relative;
        height: 100%;
      }

      body {
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .swiper {
        width: 23rem !important;
        max-width: 900px;
        height: 40em !important;
        max-height: 1000px;
      }
      @media screen and (max-width: 600px) {
        .swiper {
          width: 42vw !important;
        }
        .swiper-slide {
          font-size: 0.9em;
          padding: 1rem 0.75rem;
        }
      }
      @media screen and (max-width: 979px) {
        .swiper {
          width: 38vw !important;
          margin-left: 2rem !important;
        }
        .button {
          margin-left: 2rem !important;
        }
      }
  .swiper-slide-shadow {
    background: rgba(0, 0, 0, 0.05) !important;
  }

      .swiper-slide {
        display: flex;
        align-items: center;
        justify-content: flex-start;
        padding: 20px;
        font-size: 14px;
        background-color: #fff;
         font-family: Georgia, serif !important;
          border-radius: 14.130435% / 10.483871%;
                      border-color: rgba(156, 162, 166, 0.32);
       border-left-width: 1.5px;
      border-right-width: 1.5px;
      border-style: solid;
      border-top-width: 1.5px;
      border-bottom-width: 1.5px;

      }
      .swiper-slide {
        pointer-events: none;
      }

.slider-wrapper {
  display: flex;
  flex-direction: column;
  align-items: center;   /* center slider + button together */
  margin: 2rem auto;      /* vertical spacing + center wrapper in page */
}

.slider-wrapper .swiper {
  
  margin: 0;                     /* reset any old margins */
  margin-left: -1rem;            /* <<–– shift the whole slider a bit left */

  */
}


      .swiper-slide.swiper-slide-active {
        pointer-events: auto;
            border-color: rgba(156, 162, 166, 0.18);
       border-left-width: 1.5px;
      border-right-width: 1.5px;
      border-style: solid;
      border-top-width: 1.5px;
            border-bottom-width: 1.5px;

      }
      .bill-header {
        text-align: center;
        margin-bottom: 20px;
        line-height: 1.2;
          border-bottom: 1px solid #ccc;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
      }
      .bill-header div {
        font-variant: small-caps;
        letter-spacing: 1px;
        font-size: 0.85em;
      }
      .bill-header .bill-number {
        font-size: 1.2em;
        margin-top: 6px;
      }
      .swiper-slide h2 {
        margin: 0 0 16px;
        font-size: 1.3em;
        text-align: center;
        font-variant: small-caps;
        letter-spacing: 0.5px;
      }
      .swiper-slide p {
        line-height: 1.5;
        font-size: 0.95em;
        flex: 1;
      }
     button {
  background-color: #ffffff !important;
  color: #111827 !important;
  border: 1px solid #e5e7eb !important;
  padding: 0.5rem 0.75rem !important;
  border-radius: 0.5rem !important;
  font-size: 0.875rem !important;
  font-weight: 500 !important;
  line-height: 1.25 !important;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05) !important;
  cursor: pointer !important;
  transition: all 0.2s ease-in-out !important;
  margin: 0.3rem !important;
  position: relative !important;
  top: -0.25rem !important;
  text-align: center !important;
  margin: 0.3rem auto; /* centers it */
  position: relative;

}
      .meta {
        text-align: right;
        font-size: 0.8em;
        color: #555;
        margin-top: 20px;
        font-family: Arial, sans-serif;
      }
      
@font-face{font-family:swiper-icons;src:url('data:application/font-woff;charset=utf-8;base64, d09GRgABAAAAAAZgABAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGRlRNAAAGRAAAABoAAAAci6qHkUdERUYAAAWgAAAAIwAAACQAYABXR1BPUwAABhQAAAAuAAAANuAY7+xHU1VCAAAFxAAAAFAAAABm2fPczU9TLzIAAAHcAAAASgAAAGBP9V5RY21hcAAAAkQAAACIAAABYt6F0cBjdnQgAAACzAAAAAQAAAAEABEBRGdhc3AAAAWYAAAACAAAAAj//wADZ2x5ZgAAAywAAADMAAAD2MHtryVoZWFkAAABbAAAADAAAAA2E2+eoWhoZWEAAAGcAAAAHwAAACQC9gDzaG10eAAAAigAAAAZAAAArgJkABFsb2NhAAAC0AAAAFoAAABaFQAUGG1heHAAAAG8AAAAHwAAACAAcABAbmFtZQAAA/gAAAE5AAACXvFdBwlwb3N0AAAFNAAAAGIAAACE5s74hXjaY2BkYGAAYpf5Hu/j+W2+MnAzMYDAzaX6QjD6/4//Bxj5GA8AuRwMYGkAPywL13jaY2BkYGA88P8Agx4j+/8fQDYfA1AEBWgDAIB2BOoAeNpjYGRgYNBh4GdgYgABEMnIABJzYNADCQAACWgAsQB42mNgYfzCOIGBlYGB0YcxjYGBwR1Kf2WQZGhhYGBiYGVmgAFGBiQQkOaawtDAoMBQxXjg/wEGPcYDDA4wNUA2CCgwsAAAO4EL6gAAeNpj2M0gyAACqxgGNWBkZ2D4/wMA+xkDdgAAAHjaY2BgYGaAYBkGRgYQiAHyGMF8FgYHIM3DwMHABGQrMOgyWDLEM1T9/w8UBfEMgLzE////P/5//f/V/xv+r4eaAAeMbAxwIUYmIMHEgKYAYjUcsDAwsLKxc3BycfPw8jEQA/gZBASFhEVExcQlJKWkZWTl5BUUlZRVVNXUNTQZBgMAAMR+E+gAEQFEAAAAKgAqACoANAA+AEgAUgBcAGYAcAB6AIQAjgCYAKIArAC2AMAAygDUAN4A6ADyAPwBBgEQARoBJAEuATgBQgFMAVYBYAFqAXQBfgGIAZIBnAGmAbIBzgHsAAB42u2NMQ6CUAyGW568x9AneYYgm4MJbhKFaExIOAVX8ApewSt4Bic4AfeAid3VOBixDxfPYEza5O+Xfi04YADggiUIULCuEJK8VhO4bSvpdnktHI5QCYtdi2sl8ZnXaHlqUrNKzdKcT8cjlq+rwZSvIVczNiezsfnP/uznmfPFBNODM2K7MTQ45YEAZqGP81AmGGcF3iPqOop0r1SPTaTbVkfUe4HXj97wYE+yNwWYxwWu4v1ugWHgo3S1XdZEVqWM7ET0cfnLGxWfkgR42o2PvWrDMBSFj/IHLaF0zKjRgdiVMwScNRAoWUoH78Y2icB/yIY09An6AH2Bdu/UB+yxopYshQiEvnvu0dURgDt8QeC8PDw7Fpji3fEA4z/PEJ6YOB5hKh4dj3EvXhxPqH/SKUY3rJ7srZ4FZnh1PMAtPhwP6fl2PMJMPDgeQ4rY8YT6Gzao0eAEA409DuggmTnFnOcSCiEiLMgxCiTI6Cq5DZUd3Qmp10vO0LaLTd2cjN4fOumlc7lUYbSQcZFkutRG7g6JKZKy0RmdLY680CDnEJ+UMkpFFe1RN7nxdVpXrC4aTtnaurOnYercZg2YVmLN/d/gczfEimrE/fs/bOuq29Zmn8tloORaXgZgGa78yO9/cnXm2BpaGvq25Dv9S4E9+5SIc9PqupJKhYFSSl47+Qcr1mYNAAAAeNptw0cKwkAAAMDZJA8Q7OUJvkLsPfZ6zFVERPy8qHh2YER+3i/BP83vIBLLySsoKimrqKqpa2hp6+jq6RsYGhmbmJqZSy0sraxtbO3sHRydnEMU4uR6yx7JJXveP7WrDycAAAAAAAH//wACeNpjYGRgYOABYhkgZgJCZgZNBkYGLQZtIJsFLMYAAAw3ALgAeNolizEKgDAQBCchRbC2sFER0YD6qVQiBCv/H9ezGI6Z5XBAw8CBK/m5iQQVauVbXLnOrMZv2oLdKFa8Pjuru2hJzGabmOSLzNMzvutpB3N42mNgZGBg4GKQYzBhYMxJLMlj4GBgAYow/P/PAJJhLM6sSoWKfWCAAwDAjgbRAAB42mNgYGBkAIIbCZo5IPrmUn0hGA0AO8EFTQAA');font-weight:400;font-style:normal}:root{--swiper-theme-color:#007aff}:host{position:relative;display:block;margin-left:auto;margin-right:auto;z-index:1}.swiper{margin-left:auto;margin-right:auto;position:relative;overflow:hidden;list-style:none;padding:0;z-index:1;display:block}.swiper-vertical>.swiper-wrapper{flex-direction:column}.swiper-wrapper{position:relative;width:100%;height:100%;z-index:1;display:flex;transition-property:transform;transition-timing-function:var(--swiper-wrapper-transition-timing-function,initial);box-sizing:content-box}.swiper-android .swiper-slide,.swiper-ios .swiper-slide,.swiper-wrapper{transform:translate3d(0px,0,0)}.swiper-horizontal{touch-action:pan-y}.swiper-vertical{touch-action:pan-x}.swiper-slide{flex-shrink:0;width:100%;height:100%;position:relative;transition-property:transform;display:block}.swiper-slide-invisible-blank{visibility:hidden}.swiper-autoheight,.swiper-autoheight .swiper-slide{height:auto}.swiper-autoheight .swiper-wrapper{align-items:flex-start;transition-property:transform,height}.swiper-backface-hidden .swiper-slide{transform:translateZ(0);-webkit-backface-visibility:hidden;backface-visibility:hidden}.swiper-3d.swiper-css-mode .swiper-wrapper{perspective:1200px}.swiper-3d .swiper-wrapper{transform-style:preserve-3d}.swiper-3d{perspective:1200px}.swiper-3d .swiper-cube-shadow,.swiper-3d .swiper-slide{transform-style:preserve-3d}.swiper-css-mode>.swiper-wrapper{overflow:auto;scrollbar-width:none;-ms-overflow-style:none}.swiper-css-mode>.swiper-wrapper::-webkit-scrollbar{display:none}.swiper-css-mode>.swiper-wrapper>.swiper-slide{scroll-snap-align:start start}.swiper-css-mode.swiper-horizontal>.swiper-wrapper{scroll-snap-type:x mandatory}.swiper-css-mode.swiper-vertical>.swiper-wrapper{scroll-snap-type:y mandatory}.swiper-css-mode.swiper-free-mode>.swiper-wrapper{scroll-snap-type:none}.swiper-css-mode.swiper-free-mode>.swiper-wrapper>.swiper-slide{scroll-snap-align:none}.swiper-css-mode.swiper-centered>.swiper-wrapper::before{content:'';flex-shrink:0;order:9999}.swiper-css-mode.swiper-centered>.swiper-wrapper>.swiper-slide{scroll-snap-align:center center;scroll-snap-stop:always}.swiper-css-mode.swiper-centered.swiper-horizontal>.swiper-wrapper>.swiper-slide:first-child{margin-inline-start:var(--swiper-centered-offset-before)}.swiper-css-mode.swiper-centered.swiper-horizontal>.swiper-wrapper::before{height:100%;min-height:1px;width:var(--swiper-centered-offset-after)}.swiper-css-mode.swiper-centered.swiper-vertical>.swiper-wrapper>.swiper-slide:first-child{margin-block-start:var(--swiper-centered-offset-before)}.swiper-css-mode.swiper-centered.swiper-vertical>.swiper-wrapper::before{width:100%;min-width:1px;height:var(--swiper-centered-offset-after)}.swiper-3d .swiper-slide-shadow,.swiper-3d .swiper-slide-shadow-bottom,.swiper-3d .swiper-slide-shadow-left,.swiper-3d .swiper-slide-shadow-right,.swiper-3d .swiper-slide-shadow-top{position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:10}.swiper-3d .swiper-slide-shadow{background:rgba(0,0,0,.15)}.swiper-3d .swiper-slide-shadow-left{background-image:linear-gradient(to left,rgba(0,0,0,.5),rgba(0,0,0,0))}.swiper-3d .swiper-slide-shadow-right{background-image:linear-gradient(to right,rgba(0,0,0,.5),rgba(0,0,0,0))}.swiper-3d .swiper-slide-shadow-top{background-image:linear-gradient(to top,rgba(0,0,0,.5),rgba(0,0,0,0))}.swiper-3d .swiper-slide-shadow-bottom{background-image:linear-gradient(to bottom,rgba(0,0,0,.5),rgba(0,0,0,0))}.swiper-lazy-preloader{width:42px;height:42px;position:absolute;left:50%;top:50%;margin-left:-21px;margin-top:-21px;z-index:10;transform-origin:50%;box-sizing:border-box;border:4px solid var(--swiper-preloader-color,var(--swiper-theme-color));border-radius:50%;border-top-color:transparent}.swiper-watch-progress .swiper-slide-visible .swiper-lazy-preloader,.swiper:not(.swiper-watch-progress) .swiper-lazy-preloader{animation:swiper-preloader-spin 1s infinite linear}.swiper-lazy-preloader-white{--swiper-preloader-color:#fff}.swiper-lazy-preloader-black{--swiper-preloader-color:#000}@keyframes swiper-preloader-spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.swiper-virtual .swiper-slide{-webkit-backface-visibility:hidden;transform:translateZ(0)}.swiper-virtual.swiper-css-mode .swiper-wrapper::after{content:'';position:absolute;left:0;top:0;pointer-events:none}.swiper-virtual.swiper-css-mode.swiper-horizontal .swiper-wrapper::after{height:1px;width:var(--swiper-virtual-size)}.swiper-virtual.swiper-css-mode.swiper-vertical .swiper-wrapper::after{width:1px;height:var(--swiper-virtual-size)}:root{--swiper-navigation-size:44px}.swiper-button-next,.swiper-button-prev{position:absolute;top:var(--swiper-navigation-top-offset,50%);width:calc(var(--swiper-navigation-size)/ 44 * 27);height:var(--swiper-navigation-size);margin-top:calc(0px - (var(--swiper-navigation-size)/ 2));z-index:10;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--swiper-navigation-color,var(--swiper-theme-color))}.swiper-button-next.swiper-button-disabled,.swiper-button-prev.swiper-button-disabled{opacity:.35;cursor:auto;pointer-events:none}.swiper-button-next.swiper-button-hidden,.swiper-button-prev.swiper-button-hidden{opacity:0;cursor:auto;pointer-events:none}.swiper-navigation-disabled .swiper-button-next,.swiper-navigation-disabled .swiper-button-prev{display:none!important}.swiper-button-next svg,.swiper-button-prev svg{width:100%;height:100%;object-fit:contain;transform-origin:center}.swiper-rtl .swiper-button-next svg,.swiper-rtl .swiper-button-prev svg{transform:rotate(180deg)}.swiper-button-prev,.swiper-rtl .swiper-button-next{left:var(--swiper-navigation-sides-offset,10px);right:auto}.swiper-button-next,.swiper-rtl .swiper-button-prev{right:var(--swiper-navigation-sides-offset,10px);left:auto}.swiper-button-lock{display:none}.swiper-button-next:after,.swiper-button-prev:after{font-family:swiper-icons;font-size:var(--swiper-navigation-size);text-transform:none!important;letter-spacing:0;font-variant:initial;line-height:1}.swiper-button-prev:after,.swiper-rtl .swiper-button-next:after{content:'prev'}.swiper-button-next,.swiper-rtl .swiper-button-prev{right:var(--swiper-navigation-sides-offset,10px);left:auto}.swiper-button-next:after,.swiper-rtl .swiper-button-prev:after{content:'next'}.swiper-pagination{position:absolute;text-align:center;transition:.3s opacity;transform:translate3d(0,0,0);z-index:10}.swiper-pagination.swiper-pagination-hidden{opacity:0}.swiper-pagination-disabled>.swiper-pagination,.swiper-pagination.swiper-pagination-disabled{display:none!important}.swiper-horizontal>.swiper-pagination-bullets,.swiper-pagination-bullets.swiper-pagination-horizontal,.swiper-pagination-custom,.swiper-pagination-fraction{bottom:var(--swiper-pagination-bottom,8px);top:var(--swiper-pagination-top,auto);left:0;width:100%}.swiper-pagination-bullets-dynamic{overflow:hidden;font-size:0}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{transform:scale(.33);position:relative}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active{transform:scale(1)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-main{transform:scale(1)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-prev{transform:scale(.66)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-prev-prev{transform:scale(.33)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-next{transform:scale(.66)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-next-next{transform:scale(.33)}.swiper-pagination-bullet{width:var(--swiper-pagination-bullet-width,var(--swiper-pagination-bullet-size,8px));height:var(--swiper-pagination-bullet-height,var(--swiper-pagination-bullet-size,8px));display:inline-block;border-radius:var(--swiper-pagination-bullet-border-radius,50%);background:var(--swiper-pagination-bullet-inactive-color,#000);opacity:var(--swiper-pagination-bullet-inactive-opacity, .2)}button.swiper-pagination-bullet{border:none;margin:0;padding:0;box-shadow:none;-webkit-appearance:none;appearance:none}.swiper-pagination-clickable .swiper-pagination-bullet{cursor:pointer}.swiper-pagination-bullet:only-child{display:none!important}.swiper-pagination-bullet-active{opacity:var(--swiper-pagination-bullet-opacity, 1);background:var(--swiper-pagination-color,var(--swiper-theme-color))}.swiper-pagination-vertical.swiper-pagination-bullets,.swiper-vertical>.swiper-pagination-bullets{right:var(--swiper-pagination-right,8px);left:var(--swiper-pagination-left,auto);top:50%;transform:translate3d(0px,-50%,0)}.swiper-pagination-vertical.swiper-pagination-bullets .swiper-pagination-bullet,.swiper-vertical>.swiper-pagination-bullets .swiper-pagination-bullet{margin:var(--swiper-pagination-bullet-vertical-gap,6px) 0;display:block}.swiper-pagination-vertical.swiper-pagination-bullets.swiper-pagination-bullets-dynamic,.swiper-vertical>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic{top:50%;transform:translateY(-50%);width:8px}.swiper-pagination-vertical.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet,.swiper-vertical>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{display:inline-block;transition:.2s transform,.2s top}.swiper-horizontal>.swiper-pagination-bullets .swiper-pagination-bullet,.swiper-pagination-horizontal.swiper-pagination-bullets .swiper-pagination-bullet{margin:0 var(--swiper-pagination-bullet-horizontal-gap,4px)}.swiper-horizontal>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic,.swiper-pagination-horizontal.swiper-pagination-bullets.swiper-pagination-bullets-dynamic{left:50%;transform:translateX(-50%);white-space:nowrap}.swiper-horizontal>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet,.swiper-pagination-horizontal.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{transition:.2s transform,.2s left}.swiper-horizontal.swiper-rtl>.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{transition:.2s transform,.2s right}.swiper-pagination-fraction{color:var(--swiper-pagination-fraction-color,inherit)}.swiper-pagination-progressbar{background:var(--swiper-pagination-progressbar-bg-color,rgba(0,0,0,.25));position:absolute}.swiper-pagination-progressbar .swiper-pagination-progressbar-fill{background:var(--swiper-pagination-color,var(--swiper-theme-color));position:absolute;left:0;top:0;width:100%;height:100%;transform:scale(0);transform-origin:left top}.swiper-rtl .swiper-pagination-progressbar .swiper-pagination-progressbar-fill{transform-origin:right top}.swiper-horizontal>.swiper-pagination-progressbar,.swiper-pagination-progressbar.swiper-pagination-horizontal,.swiper-pagination-progressbar.swiper-pagination-vertical.swiper-pagination-progressbar-opposite,.swiper-vertical>.swiper-pagination-progressbar.swiper-pagination-progressbar-opposite{width:100%;height:var(--swiper-pagination-progressbar-size,4px);left:0;top:0}.swiper-horizontal>.swiper-pagination-progressbar.swiper-pagination-progressbar-opposite,.swiper-pagination-progressbar.swiper-pagination-horizontal.swiper-pagination-progressbar-opposite,.swiper-pagination-progressbar.swiper-pagination-vertical,.swiper-vertical>.swiper-pagination-progressbar{width:var(--swiper-pagination-progressbar-size,4px);height:100%;left:0;top:0}.swiper-pagination-lock{display:none}.swiper-scrollbar{border-radius:var(--swiper-scrollbar-border-radius,10px);position:relative;touch-action:none;background:var(--swiper-scrollbar-bg-color,rgba(0,0,0,.1))}.swiper-scrollbar-disabled>.swiper-scrollbar,.swiper-scrollbar.swiper-scrollbar-disabled{display:none!important}.swiper-horizontal>.swiper-scrollbar,.swiper-scrollbar.swiper-scrollbar-horizontal{position:absolute;left:var(--swiper-scrollbar-sides-offset,1%);bottom:var(--swiper-scrollbar-bottom,4px);top:var(--swiper-scrollbar-top,auto);z-index:50;height:var(--swiper-scrollbar-size,4px);width:calc(100% - 2 * var(--swiper-scrollbar-sides-offset,1%))}.swiper-scrollbar.swiper-scrollbar-vertical,.swiper-vertical>.swiper-scrollbar{position:absolute;left:var(--swiper-scrollbar-left,auto);right:var(--swiper-scrollbar-right,4px);top:var(--swiper-scrollbar-sides-offset,1%);z-index:50;width:var(--swiper-scrollbar-size,4px);height:calc(100% - 2 * var(--swiper-scrollbar-sides-offset,1%))}.swiper-scrollbar-drag{height:100%;width:100%;position:relative;background:var(--swiper-scrollbar-drag-bg-color,rgba(0,0,0,.5));border-radius:var(--swiper-scrollbar-border-radius,10px);left:0;top:0}.swiper-scrollbar-cursor-drag{cursor:move}.swiper-scrollbar-lock{display:none}.swiper-zoom-container{width:100%;height:100%;display:flex;justify-content:center;align-items:center;text-align:center}.swiper-zoom-container>canvas,.swiper-zoom-container>img,.swiper-zoom-container>svg{max-width:100%;max-height:100%;object-fit:contain}.swiper-slide-zoomed{cursor:move;touch-action:none}.swiper .swiper-notification{position:absolute;left:0;top:0;pointer-events:none;opacity:0;z-index:-1000}.swiper-free-mode>.swiper-wrapper{transition-timing-function:ease-out;margin:0 auto}.swiper-grid>.swiper-wrapper{flex-wrap:wrap}.swiper-grid-column>.swiper-wrapper{flex-wrap:wrap;flex-direction:column}.swiper-fade.swiper-free-mode .swiper-slide{transition-timing-function:ease-out}.swiper-fade .swiper-slide{pointer-events:none;transition-property:opacity}.swiper-fade .swiper-slide .swiper-slide{pointer-events:none}.swiper-fade .swiper-slide-active{pointer-events:auto}.swiper-fade .swiper-slide-active .swiper-slide-active{pointer-events:auto}.swiper.swiper-cube{overflow:visible}.swiper-cube .swiper-slide{pointer-events:none;-webkit-backface-visibility:hidden;backface-visibility:hidden;z-index:1;visibility:hidden;transform-origin:0 0;width:100%;height:100%}.swiper-cube .swiper-slide .swiper-slide{pointer-events:none}.swiper-cube.swiper-rtl .swiper-slide{transform-origin:100% 0}.swiper-cube .swiper-slide-active,.swiper-cube .swiper-slide-active .swiper-slide-active{pointer-events:auto}.swiper-cube .swiper-slide-active,.swiper-cube .swiper-slide-next,.swiper-cube .swiper-slide-prev{pointer-events:auto;visibility:visible}.swiper-cube .swiper-cube-shadow{position:absolute;left:0;bottom:0px;width:100%;height:100%;opacity:.6;z-index:0}.swiper-cube .swiper-cube-shadow:before{content:'';background:#000;position:absolute;left:0;top:0;bottom:0;right:0;filter:blur(50px)}.swiper-cube .swiper-slide-next+.swiper-slide{pointer-events:auto;visibility:visible}.swiper-cube .swiper-slide-shadow-cube.swiper-slide-shadow-bottom,.swiper-cube .swiper-slide-shadow-cube.swiper-slide-shadow-left,.swiper-cube .swiper-slide-shadow-cube.swiper-slide-shadow-right,.swiper-cube .swiper-slide-shadow-cube.swiper-slide-shadow-top{z-index:0;-webkit-backface-visibility:hidden;backface-visibility:hidden}.swiper.swiper-flip{overflow:visible}.swiper-flip .swiper-slide{pointer-events:none;-webkit-backface-visibility:hidden;backface-visibility:hidden;z-index:1}.swiper-flip .swiper-slide .swiper-slide{pointer-events:none}.swiper-flip .swiper-slide-active,.swiper-flip .swiper-slide-active .swiper-slide-active{pointer-events:auto}.swiper-flip .swiper-slide-shadow-flip.swiper-slide-shadow-bottom,.swiper-flip .swiper-slide-shadow-flip.swiper-slide-shadow-left,.swiper-flip .swiper-slide-shadow-flip.swiper-slide-shadow-right,.swiper-flip .swiper-slide-shadow-flip.swiper-slide-shadow-top{z-index:0;-webkit-backface-visibility:hidden;backface-visibility:hidden}.swiper-creative .swiper-slide{-webkit-backface-visibility:hidden;backface-visibility:hidden;overflow:hidden;transition-property:transform,opacity,height}.swiper.swiper-cards{overflow:visible}.swiper-cards .swiper-slide{transform-origin:center bottom;-webkit-backface-visibility:hidden;backface-visibility:hidden;overflow:hidden}
    </style>




    <div class="slider-wrapper">

    <div class="swiper mySwiper">
      <div class="swiper-wrapper">
        <div class="swiper-slide">
          <div class="bill-header">
            <div>117<sup>th</sup> Congress</div>
            <div>1<sup>st</sup> Session</div>
            <div class="bill-number">H.R. 5501</div>
          </div>
          <h2>Bill 1</h2>
          <p>
            Be it enacted by the Senate and House of Representatives of the
            United States of America in Congress assembled:<br /><br />
            <strong>Section 1. Short title.</strong><br />
            This Act may be cited as the “Environmental Justice Act of 2025.”<br /><br />
            <strong>Section 2. Findings.</strong><br />
            (1) Communities of color and low-income communities face
            disproportionate environmental burdens.<br />
            (2) <em>Additional findings to be inserted…</em>
          </p>
          <div class="meta">
            Sponsor: Rep. Jane Doe | Introduced: March 5, 2025
          </div>
        </div>
        <div class="swiper-slide">
          <div class="bill-header">
            <div>117<sup>th</sup> Congress</div>
            <div>1<sup>st</sup> Session</div>
            <div class="bill-number">S. 2202</div>
          </div>
          <h2>Bill 2</h2>
          <p>
            Be it enacted by the Senate and House of Representatives of the
            United States of America in Congress assembled:<br /><br />
            <strong>Section 1. Short title.</strong><br />
            This Act may be cited as the “Clean Water for All Act.”<br /><br />
            <strong>Section 2. Purpose.</strong><br />
            (1) To ensure access to safe and affordable drinking water for all
            Americans.<br />
            (2) <em>Further provisions to follow…</em>
          </p>
          <div class="meta">
            Sponsor: Sen. John Smith | Introduced: February 12, 2025
          </div>
        </div>
        <div class="swiper-slide">
          <div class="bill-header">
            <div>117<sup>th</sup> Congress</div>
            <div>1<sup>st</sup> Session</div>
            <div class="bill-number">H.R. 3305</div>
          </div>
          <h2>Bill 3</h2>
          <p>
            Be it enacted by the Senate and House of Representatives of the
            United States of America in Congress assembled:<br /><br />
            <strong>Section 1. Short title.</strong><br />
            This Act may be cited as the “Affordable Housing Expansion Act.”<br /><br />
            <strong>Section 2. Findings.</strong><br />
            (1) There is a national shortage of affordable housing.<br />
            (2) <em>Additional findings to be inserted…</em>
          </p>
          <div class="meta">
            Sponsor: Rep. Maria Lee | Introduced: January 20, 2025
          </div>
        </div>
        <div class="swiper-slide">
          <div class="bill-header">
            <div>117<sup>th</sup> Congress</div>
            <div>1<sup>st</sup> Session</div>
            <div class="bill-number">S. 1457</div>
          </div>
          <h2>Bill 4</h2>
          <p>
            Be it enacted by the Senate and House of Representatives of the
            United States of America in Congress assembled:<br /><br />
            <strong>Section 1. Short title.</strong><br />
            This Act may be cited as the “National Broadband Expansion Act.”<br /><br />
            <strong>Section 2. Findings.</strong><br />
            (1) Universal broadband access is essential for economic
            opportunity.<br />
            (2) <em>Further findings to be inserted…</em>
          </p>
          <div class="meta">
            Sponsor: Sen. Alex Kim | Introduced: March 10, 2025
          </div>
        </div>
        <div class="swiper-slide">
          <div class="bill-header">
            <div>117<sup>th</sup> Congress</div>
            <div>1<sup>st</sup> Session</div>
            <div class="bill-number">H.R. 2077</div>
          </div>
          <h2>Bill 5</h2>
          <p>
            Be it enacted by the Senate and House of Representatives of the
            United States of America in Congress assembled:<br /><br />
            <strong>Section 1. Short title.</strong><br />
            This Act may be cited as the “Student Debt Relief Act.”<br /><br />
            <strong>Section 2. Purpose.</strong><br />
            (1) To provide relief for federal student loan borrowers.<br />
            (2) <em>Additional provisions to be inserted…</em>
          </p>
          <div class="meta">
            Sponsor: Rep. Linda Tran | Introduced: February 28, 2025
          </div>
        </div>
        <div class="swiper-slide">
          <div class="bill-header">
            <div>117<sup>th</sup> Congress</div>
            <div>1<sup>st</sup> Session</div>
            <div class="bill-number">S. 3890</div>
          </div>
          <h2>Bill 6</h2>
          <p>
            Be it enacted by the Senate and House of Representatives of the
            United States of America in Congress assembled:<br /><br />
            <strong>Section 1. Short title.</strong><br />
            This Act may be cited as the “Climate Resilience Infrastructure
            Act.”<br /><br />
            <strong>Section 2. Findings.</strong><br />
            (1) Infrastructure must be modernized to withstand climate
            change.<br />
            (2) <em>Further findings to be inserted…</em>
          </p>
          <div class="meta">
            Sponsor: Sen. Priya Patel | Introduced: January 30, 2025
          </div>
        </div>
        <div class="swiper-slide">
          <div class="bill-header">
            <div>117<sup>th</sup> Congress</div>
            <div>1<sup>st</sup> Session</div>
            <div class="bill-number">H.R. 9999</div>
          </div>
          <h2>Bill 7</h2>
          <p>
            Be it enacted by the Senate and House of Representatives of the
            United States of America in Congress assembled:<br /><br />
            <strong>Section 1. Short title.</strong><br />
            This Act may be cited as the “Universal Childcare Access Act.”<br /><br />
            <strong>Section 2. Purpose.</strong><br />
            (1) To expand access to affordable childcare services.<br />
            (2) <em>Further provisions to be inserted…</em>
          </p>
          <div class="meta">
            Sponsor: Rep. Samuel Green | Introduced: March 2, 2025
          </div>
        </div>
        <div class="swiper-slide">
          <div class="bill-header">
            <div>117<sup>th</sup> Congress</div>
            <div>1<sup>st</sup> Session</div>
            <div class="bill-number">S. 1010</div>
          </div>
          <h2>Bill 8</h2>
          <p>
            Be it enacted by the Senate and House of Representatives of the
            United States of America in Congress assembled:<br /><br />
            <strong>Section 1. Short title.</strong><br />
            This Act may be cited as the “Healthcare Equity Advancement Act.”<br /><br />
            <strong>Section 2. Findings.</strong><br />
            (1) Persistent disparities exist in healthcare access and
            outcomes.<br />
            (2) <em>Additional findings to be inserted…</em>
          </p>
          <div class="meta">
            Sponsor: Sen. Emily Carter | Introduced: January 15, 2025
          </div>
        </div>
        <div class="swiper-slide">
          <div class="bill-header">
            <div>117<sup>th</sup> Congress</div>
            <div>1<sup>st</sup> Session</div>
            <div class="bill-number">H.R. 8888</div>
          </div>
          <h2>Bill 9</h2>
          <p>
            Be it enacted by the Senate and House of Representatives of the
            United States of America in Congress assembled:<br /><br />
            <strong>Section 1. Short title.</strong><br />
            This Act may be cited as the “Small Business Recovery Act.”<br /><br />
            <strong>Section 2. Purpose.</strong><br />
            (1) To support small businesses in recovering from economic
            downturns.<br />
            (2) <em>Further provisions to follow…</em>
          </p>
          <div class="meta">
            Sponsor: Rep. Olivia Brown | Introduced: February 10, 2025
          </div>
        </div>
      </div>
     
    </div>

    <div style="display: flex; flex-direction: column; align-items: center; margin-top: 2em;">
  <<button "OK">>
    <<run (()=>{
      const map = [
        "Bill 1",
        "Bill 2",
        "Bill 3",
        "Bill 4"
      ];
      // get the active slide index
      const idx = window.mySwiper.activeIndex;
      // play the corresponding passage
      Engine.play(map[idx]);
    })()>>
  <</button>>
</div>
</div>
    </div>





:: BuildCanadaHomes {"position":"600,700","size":"100,100"}
<!-- CSS Styling -->
<style>
  .build-intro {
    max-width: 700px;
    margin: 0 auto;
    padding: 40px 20px;
    text-align: center;
    font-size: 1.2em;
    margin-top: 5rem;
    line-height: 1.6;
    margin-bottom: 2rem;
    color: #1c1c1e;
  }
.button {
  background-color: rgb(32, 117, 202);
  background-image: linear-gradient(rgb(41, 122, 202), rgb(30, 104, 178));
  border: 1px solid rgb(38, 111, 185); /* ✔ Correct border color */
  border-radius: 12px;
  box-shadow: rgba(0, 0, 0, 0.12) 0 1px 1px;
  color: #FFFFFF;
  cursor: pointer;
  display: block;
  font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Helvetica, Arial, sans-serif;
  font-size: 1rem;
  font-weight: 400;
  line-height: 1.25;
  padding: 0.65rem 1rem;
  text-align: center;
  transition: box-shadow 0.15s ease, transform 0.15s ease;
  user-select: none;
  -webkit-user-select: none;
  touch-action: manipulation;
  width: 100%;
  max-width: 420px;
  margin: 0.9rem auto;
  position: relative;
  top: -0.25rem;
}

.button:hover {
  background-image: linear-gradient(rgb(51, 130, 210), rgb(39, 121, 202));
  box-shadow: rgba(255, 255, 255, 0.3) 0 0 2px inset,
              rgba(0, 0, 0, 0.4) 0 1px 2px;
  border-color: rgb(44, 123, 202); /* ✔ Reinforce border on hover */
}

.button:active {
  transform: scale(0.98);
  box-shadow: rgba(0, 0, 0, 0.15) 0 2px 4px inset,
              rgba(0, 0, 0, 0.4) 0 1px 1px;
  border-color: rgb(44, 123, 202); /* ✔ Reinforce border on click */
}

.button:focus {
  outline: none;
  box-shadow: 0 0 0 3px rgba(58, 122, 217, 0.5);
  border-color: rgb(44, 123, 202); /* ✔ Keep border consistent on focus */
}

.button:disabled {
  cursor: not-allowed;
  opacity: 0.6;
  box-shadow: none;
  border-color: #2a5a87; /* ✔ Still visible, but dimmed */
}

.button:disabled:hover,
.button:disabled:active {
  pointer-events: none;
  box-shadow: none;
}
.button:first-of-type {
  margin-top: 1rem;
}
</style>
<!-- Intro Text -->
<div class="passage-content">
<div class="build-intro">
  <p>
    The federal government launches <strong>Build Canada Homes</strong>, its most ambitious housing program since WWII.
    The program offers billions in financing, standardized housing designs, and land access for cities ready to build.
    Your city has been invited to submit a proposal. Do you focus on mass affordable units, starter homes, or innovative pilots?
  </p>

  <!-- Buttons with individual policy registration and passage jump -->
  <button class="button" onclick="buildAffordable();">Prioritize mid-rise apartment buildings with deeply affordable and supportive units.</button>
  <button class="button" onclick="buildStarter();">Focus on starter homes and affordable ownership for middle-income families.</button>
  <button class="button" onclick="buildModular();">Lead a modular housing and office-to-residential conversion pilot on underused land.</button>
</div>

<!-- Policy Scripts -->
<script>
  function buildAffordable() {
    PolicyManager.register({
      name: "Build City Affordable Housing",
      costUpfront: 10,
      duration: 999999,
      immediate(v) {
        v.publicOpinion -= 15;
      },
      tick(v, Util, age) {
        let cost = 8;
        if (age >= 2) cost = 0.42;
        if (age >= 5) cost = 0.12;
        if (age >= 7) cost = -0.5;
        v.budget -= cost;

        if (age >= 2) {
          const exits = 100 + Math.floor(25 * (age - 2));
          window.Util.exitPeople(exits);
        }

        if (age >= 10 && age < 30) {
          v.serviceCoordination += 2;
        }
      }
    });
    SugarCube.Engine.play("PreServiceFunding");
  }

  function buildStarter() {
    PolicyManager.register({
      name: "Starter Homes Expansion",
      costUpfront: 8,
      duration: 999999,
      immediate(v) {
        v.publicOpinion += 10;
        v.inflow -= 5;
      },
      tick(v, Util, age) {
        let cost = 5;
        if (age >= 3) cost = 1;
        if (age >= 6) cost = -0.25;
        v.budget -= cost;

        if (age >= 3) {
          v.housingSupply += 150;
        }
      }
    });
    SugarCube.Engine.play("PreServiceFunding");
  }

  function buildModular() {
    PolicyManager.register({
      name: "Modular Housing & Office Conversions",
      costUpfront: 6,
      duration: 999999,
      immediate(v) {
        v.publicOpinion += 5;
        v.systemCapacity += 10;
      },
      tick(v, Util, age) {
        let cost = 3;
        if (age >= 2) cost = 0.8;
        if (age >= 4) cost = 0.2;
        v.budget -= cost;

        if (age >= 2) {
          const exits = 80 + Math.floor(15 * (age - 2));
          window.Util.exitPeople(exits);
        }

        if (age >= 6) {
          v.systemCapacity += 3;
        }
      }
    });
    SugarCube.Engine.play("PreServiceFunding");
  }
</script>
</div>


:: ChooseCityPolicy1 {"position":"600,300","size":"100,100"}
<<script>>
// run on *every* time this passage finishes displaying
$(document).on(':passagedisplay', function (ev) {
  // 1) inject the CSS if we haven't already
  if (!$('head').find('link[href*="swiper-bundle.min.css"]').length) {
    $('head').append(
      '<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">'
    );
  }

  // 2) helper to actually init the carousel
  function setupSwiper() {
    const el = ev.content.querySelector('.mySwiper');
    if (!el) return;
    if (window.mySwiper) {
      window.mySwiper.destroy(true, true);
    }
    // ← here’s the only change: add observer + observeParents
    window.mySwiper = new Swiper(el, {
      effect:      'cards',
      grabCursor:  true,
      observer:        true,
      observeParents:  true
    });
  }

  // 3) load Swiper.js if needed, otherwise just init
  if (typeof Swiper === 'undefined') {
    $.getScript('https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js')
     .done(setupSwiper)
     .fail(() => console.error('Failed to load Swiper.'));
  }
  else {
    setupSwiper();
  }
});
<</script>>

<div class="passageContent"> 




    <!-- Demo styles -->
    <style>

:root {
zoom: 1.1;
}
      html,
      body {
        position: relative;
        height: 100%;
      }

      body {
        background: #eee;
        font-family: Helvetica Neue, Helvetica, Arial, sans-serif;
        font-size: 14px;
        color: #000;
        margin: 0;
        padding: 0;
      }

      body {
        background: #fff;
        font-family: Helvetica Neue, Helvetica, Arial, sans-serif;
        font-size: 14px;
        color: #000;
        margin: 0;
        padding: 0;
      }

      html,
      body {
        position: relative;
        height: 100%;
      }

      body {
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .swiper {
        width: 23rem !important;
        max-width: 900px;
        height: 40em !important;
        max-height: 1000px;
      }
      @media screen and (max-width: 600px) {
        .swiper {
          width: 42vw !important;
        }
        .swiper-slide {
          font-size: 0.9em;
          padding: 1rem 0.75rem;
        }
      }
      @media screen and (max-width: 979px) {
        .swiper {
          width: 38vw !important;
          margin-left: 2rem !important;
        }
        .button {
          margin-left: 2rem !important;
        }
      }
  .swiper-slide-shadow {
    background: rgba(0, 0, 0, 0.05) !important;
  }
  @media screen and (max-width: 979px) {
    .swiper {
      width: 38vw !important;
      margin-left: 2rem !important;
    }
  
    .button {
      margin-left: 2rem !important;
    }
  
    .swiper-slide {
      font-size: 0.85em; 
      padding: 1rem 0.75rem;
    }
    
    .impacts {
      display: none; 
    }
  }
      .swiper-slide {
        display: flex;
        align-items: center;
        justify-content: flex-start;
        padding: 20px;
        font-size: 14px;
        background-color: #fff;
          border-radius: 14.130435% / 10.483871%;
                      border-color: rgba(156, 162, 166, 0.32);
       border-left-width: 1.5px;
      border-right-width: 1.5px;
      border-style: solid;
      border-top-width: 1.5px;
      border-bottom-width: 1.5px;

      }
      .swiper-slide {
        pointer-events: none;
      }

.slider-wrapper {
  display: flex;
  flex-direction: column;
  align-items: center;   /* center slider + button together */
  margin: 2rem auto;      /* vertical spacing + center wrapper in page */
}

.slider-wrapper .swiper {
  
  margin: 0;                     /* reset any old margins */
  margin-left: -1rem;            /* <<–– shift the whole slider a bit left */

  */
}


      .swiper-slide.swiper-slide-active {
        pointer-events: auto;
            border-color: rgba(156, 162, 166, 0.18);
       border-left-width: 1.5px;
      border-right-width: 1.5px;
      border-style: solid;
      border-top-width: 1.5px;
            border-bottom-width: 1.5px;

      }
      .break {
        display: block;
        content: "";
      }
      .small-break {
        display: block;
        content: "";
      }
      .bill-header {
        text-align: center;
        margin-bottom: 20px;
        line-height: 1.2;
          border-bottom: 1px solid #ccc;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
      }
      .bill-header div {
        font-variant: small-caps;
        letter-spacing: 1px;
        font-size: 0.85em;
      }
      .bill-header .bill-number {
        font-size: 1.2em;
        margin-top: 6px;
      }
      .swiper-slide h2 {
        margin: 0 0 16px;
        font-size: 1.3em;
        text-align: center;
        font-variant: small-caps;
        letter-spacing: 0.5px;
      }
      .swiper-slide p {
        line-height: 1.5;
        font-size: 0.95em;
        flex: 1;
      }
     button {
  background-color: #ffffff !important;
  color: #111827 !important;
  border: 1px solid #e5e7eb !important;
  padding: 0.5rem 0.75rem !important;
  border-radius: 0.5rem !important;
  font-size: 0.875rem !important;
  font-weight: 500 !important;
  line-height: 1.25 !important;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05) !important;
  cursor: pointer !important;
  transition: all 0.2s ease-in-out !important;
  margin: 0.3rem !important;
  position: relative !important;
  top: -0.25rem !important;
  text-align: center !important;
  margin: 0.3rem auto; /* centers it */
  position: relative;

}
      .meta {
        text-align: right;
        font-size: 0.8em;
        color: #555;
        margin-top: 20px;
        font-family: Arial, sans-serif;
      }
      
@font-face{font-family:swiper-icons;src:url('data:application/font-woff;charset=utf-8;base64, d09GRgABAAAAAAZgABAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGRlRNAAAGRAAAABoAAAAci6qHkUdERUYAAAWgAAAAIwAAACQAYABXR1BPUwAABhQAAAAuAAAANuAY7+xHU1VCAAAFxAAAAFAAAABm2fPczU9TLzIAAAHcAAAASgAAAGBP9V5RY21hcAAAAkQAAACIAAABYt6F0cBjdnQgAAACzAAAAAQAAAAEABEBRGdhc3AAAAWYAAAACAAAAAj//wADZ2x5ZgAAAywAAADMAAAD2MHtryVoZWFkAAABbAAAADAAAAA2E2+eoWhoZWEAAAGcAAAAHwAAACQC9gDzaG10eAAAAigAAAAZAAAArgJkABFsb2NhAAAC0AAAAFoAAABaFQAUGG1heHAAAAG8AAAAHwAAACAAcABAbmFtZQAAA/gAAAE5AAACXvFdBwlwb3N0AAAFNAAAAGIAAACE5s74hXjaY2BkYGAAYpf5Hu/j+W2+MnAzMYDAzaX6QjD6/4//Bxj5GA8AuRwMYGkAPywL13jaY2BkYGA88P8Agx4j+/8fQDYfA1AEBWgDAIB2BOoAeNpjYGRgYNBh4GdgYgABEMnIABJzYNADCQAACWgAsQB42mNgYfzCOIGBlYGB0YcxjYGBwR1Kf2WQZGhhYGBiYGVmgAFGBiQQkOaawtDAoMBQxXjg/wEGPcYDDA4wNUA2CCgwsAAAO4EL6gAAeNpj2M0gyAACqxgGNWBkZ2D4/wMA+xkDdgAAAHjaY2BgYGaAYBkGRgYQiAHyGMF8FgYHIM3DwMHABGQrMOgyWDLEM1T9/w8UBfEMgLzE////P/5//f/V/xv+r4eaAAeMbAxwIUYmIMHEgKYAYjUcsDAwsLKxc3BycfPw8jEQA/gZBASFhEVExcQlJKWkZWTl5BUUlZRVVNXUNTQZBgMAAMR+E+gAEQFEAAAAKgAqACoANAA+AEgAUgBcAGYAcAB6AIQAjgCYAKIArAC2AMAAygDUAN4A6ADyAPwBBgEQARoBJAEuATgBQgFMAVYBYAFqAXQBfgGIAZIBnAGmAbIBzgHsAAB42u2NMQ6CUAyGW568x9AneYYgm4MJbhKFaExIOAVX8ApewSt4Bic4AfeAid3VOBixDxfPYEza5O+Xfi04YADggiUIULCuEJK8VhO4bSvpdnktHI5QCYtdi2sl8ZnXaHlqUrNKzdKcT8cjlq+rwZSvIVczNiezsfnP/uznmfPFBNODM2K7MTQ45YEAZqGP81AmGGcF3iPqOop0r1SPTaTbVkfUe4HXj97wYE+yNwWYxwWu4v1ugWHgo3S1XdZEVqWM7ET0cfnLGxWfkgR42o2PvWrDMBSFj/IHLaF0zKjRgdiVMwScNRAoWUoH78Y2icB/yIY09An6AH2Bdu/UB+yxopYshQiEvnvu0dURgDt8QeC8PDw7Fpji3fEA4z/PEJ6YOB5hKh4dj3EvXhxPqH/SKUY3rJ7srZ4FZnh1PMAtPhwP6fl2PMJMPDgeQ4rY8YT6Gzao0eAEA409DuggmTnFnOcSCiEiLMgxCiTI6Cq5DZUd3Qmp10vO0LaLTd2cjN4fOumlc7lUYbSQcZFkutRG7g6JKZKy0RmdLY680CDnEJ+UMkpFFe1RN7nxdVpXrC4aTtnaurOnYercZg2YVmLN/d/gczfEimrE/fs/bOuq29Zmn8tloORaXgZgGa78yO9/cnXm2BpaGvq25Dv9S4E9+5SIc9PqupJKhYFSSl47+Qcr1mYNAAAAeNptw0cKwkAAAMDZJA8Q7OUJvkLsPfZ6zFVERPy8qHh2YER+3i/BP83vIBLLySsoKimrqKqpa2hp6+jq6RsYGhmbmJqZSy0sraxtbO3sHRydnEMU4uR6yx7JJXveP7WrDycAAAAAAAH//wACeNpjYGRgYOABYhkgZgJCZgZNBkYGLQZtIJsFLMYAAAw3ALgAeNolizEKgDAQBCchRbC2sFER0YD6qVQiBCv/H9ezGI6Z5XBAw8CBK/m5iQQVauVbXLnOrMZv2oLdKFa8Pjuru2hJzGabmOSLzNMzvutpB3N42mNgZGBg4GKQYzBhYMxJLMlj4GBgAYow/P/PAJJhLM6sSoWKfWCAAwDAjgbRAAB42mNgYGBkAIIbCZo5IPrmUn0hGA0AO8EFTQAA');font-weight:400;font-style:normal}:root{--swiper-theme-color:#007aff}:host{position:relative;display:block;margin-left:auto;margin-right:auto;z-index:1}.swiper{margin-left:auto;margin-right:auto;position:relative;overflow:hidden;list-style:none;padding:0;z-index:1;display:block}.swiper-vertical>.swiper-wrapper{flex-direction:column}.swiper-wrapper{position:relative;width:100%;height:100%;z-index:1;display:flex;transition-property:transform;transition-timing-function:var(--swiper-wrapper-transition-timing-function,initial);box-sizing:content-box}.swiper-android .swiper-slide,.swiper-ios .swiper-slide,.swiper-wrapper{transform:translate3d(0px,0,0)}.swiper-horizontal{touch-action:pan-y}.swiper-vertical{touch-action:pan-x}.swiper-slide{flex-shrink:0;width:100%;height:100%;position:relative;transition-property:transform;display:block}.swiper-slide-invisible-blank{visibility:hidden}.swiper-autoheight,.swiper-autoheight .swiper-slide{height:auto}.swiper-autoheight .swiper-wrapper{align-items:flex-start;transition-property:transform,height}.swiper-backface-hidden .swiper-slide{transform:translateZ(0);-webkit-backface-visibility:hidden;backface-visibility:hidden}.swiper-3d.swiper-css-mode .swiper-wrapper{perspective:1200px}.swiper-3d .swiper-wrapper{transform-style:preserve-3d}.swiper-3d{perspective:1200px}.swiper-3d .swiper-cube-shadow,.swiper-3d .swiper-slide{transform-style:preserve-3d}.swiper-css-mode>.swiper-wrapper{overflow:auto;scrollbar-width:none;-ms-overflow-style:none}.swiper-css-mode>.swiper-wrapper::-webkit-scrollbar{display:none}.swiper-css-mode>.swiper-wrapper>.swiper-slide{scroll-snap-align:start start}.swiper-css-mode.swiper-horizontal>.swiper-wrapper{scroll-snap-type:x mandatory}.swiper-css-mode.swiper-vertical>.swiper-wrapper{scroll-snap-type:y mandatory}.swiper-css-mode.swiper-free-mode>.swiper-wrapper{scroll-snap-type:none}.swiper-css-mode.swiper-free-mode>.swiper-wrapper>.swiper-slide{scroll-snap-align:none}.swiper-css-mode.swiper-centered>.swiper-wrapper::before{content:'';flex-shrink:0;order:9999}.swiper-css-mode.swiper-centered>.swiper-wrapper>.swiper-slide{scroll-snap-align:center center;scroll-snap-stop:always}.swiper-css-mode.swiper-centered.swiper-horizontal>.swiper-wrapper>.swiper-slide:first-child{margin-inline-start:var(--swiper-centered-offset-before)}.swiper-css-mode.swiper-centered.swiper-horizontal>.swiper-wrapper::before{height:100%;min-height:1px;width:var(--swiper-centered-offset-after)}.swiper-css-mode.swiper-centered.swiper-vertical>.swiper-wrapper>.swiper-slide:first-child{margin-block-start:var(--swiper-centered-offset-before)}.swiper-css-mode.swiper-centered.swiper-vertical>.swiper-wrapper::before{width:100%;min-width:1px;height:var(--swiper-centered-offset-after)}.swiper-3d .swiper-slide-shadow,.swiper-3d .swiper-slide-shadow-bottom,.swiper-3d .swiper-slide-shadow-left,.swiper-3d .swiper-slide-shadow-right,.swiper-3d .swiper-slide-shadow-top{position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:10}.swiper-3d .swiper-slide-shadow{background:rgba(0,0,0,.15)}.swiper-3d .swiper-slide-shadow-left{background-image:linear-gradient(to left,rgba(0,0,0,.5),rgba(0,0,0,0))}.swiper-3d .swiper-slide-shadow-right{background-image:linear-gradient(to right,rgba(0,0,0,.5),rgba(0,0,0,0))}.swiper-3d .swiper-slide-shadow-top{background-image:linear-gradient(to top,rgba(0,0,0,.5),rgba(0,0,0,0))}.swiper-3d .swiper-slide-shadow-bottom{background-image:linear-gradient(to bottom,rgba(0,0,0,.5),rgba(0,0,0,0))}.swiper-lazy-preloader{width:42px;height:42px;position:absolute;left:50%;top:50%;margin-left:-21px;margin-top:-21px;z-index:10;transform-origin:50%;box-sizing:border-box;border:4px solid var(--swiper-preloader-color,var(--swiper-theme-color));border-radius:50%;border-top-color:transparent}.swiper-watch-progress .swiper-slide-visible .swiper-lazy-preloader,.swiper:not(.swiper-watch-progress) .swiper-lazy-preloader{animation:swiper-preloader-spin 1s infinite linear}.swiper-lazy-preloader-white{--swiper-preloader-color:#fff}.swiper-lazy-preloader-black{--swiper-preloader-color:#000}@keyframes swiper-preloader-spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.swiper-virtual .swiper-slide{-webkit-backface-visibility:hidden;transform:translateZ(0)}.swiper-virtual.swiper-css-mode .swiper-wrapper::after{content:'';position:absolute;left:0;top:0;pointer-events:none}.swiper-virtual.swiper-css-mode.swiper-horizontal .swiper-wrapper::after{height:1px;width:var(--swiper-virtual-size)}.swiper-virtual.swiper-css-mode.swiper-vertical .swiper-wrapper::after{width:1px;height:var(--swiper-virtual-size)}:root{--swiper-navigation-size:44px}.swiper-button-next,.swiper-button-prev{position:absolute;top:var(--swiper-navigation-top-offset,50%);width:calc(var(--swiper-navigation-size)/ 44 * 27);height:var(--swiper-navigation-size);margin-top:calc(0px - (var(--swiper-navigation-size)/ 2));z-index:10;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--swiper-navigation-color,var(--swiper-theme-color))}.swiper-button-next.swiper-button-disabled,.swiper-button-prev.swiper-button-disabled{opacity:.35;cursor:auto;pointer-events:none}.swiper-button-next.swiper-button-hidden,.swiper-button-prev.swiper-button-hidden{opacity:0;cursor:auto;pointer-events:none}.swiper-navigation-disabled .swiper-button-next,.swiper-navigation-disabled .swiper-button-prev{display:none!important}.swiper-button-next svg,.swiper-button-prev svg{width:100%;height:100%;object-fit:contain;transform-origin:center}.swiper-rtl .swiper-button-next svg,.swiper-rtl .swiper-button-prev svg{transform:rotate(180deg)}.swiper-button-prev,.swiper-rtl .swiper-button-next{left:var(--swiper-navigation-sides-offset,10px);right:auto}.swiper-button-next,.swiper-rtl .swiper-button-prev{right:var(--swiper-navigation-sides-offset,10px);left:auto}.swiper-button-lock{display:none}.swiper-button-next:after,.swiper-button-prev:after{font-family:swiper-icons;font-size:var(--swiper-navigation-size);text-transform:none!important;letter-spacing:0;font-variant:initial;line-height:1}.swiper-button-prev:after,.swiper-rtl .swiper-button-next:after{content:'prev'}.swiper-button-next,.swiper-rtl .swiper-button-prev{right:var(--swiper-navigation-sides-offset,10px);left:auto}.swiper-button-next:after,.swiper-rtl .swiper-button-prev:after{content:'next'}.swiper-pagination{position:absolute;text-align:center;transition:.3s opacity;transform:translate3d(0,0,0);z-index:10}.swiper-pagination.swiper-pagination-hidden{opacity:0}.swiper-pagination-disabled>.swiper-pagination,.swiper-pagination.swiper-pagination-disabled{display:none!important}.swiper-horizontal>.swiper-pagination-bullets,.swiper-pagination-bullets.swiper-pagination-horizontal,.swiper-pagination-custom,.swiper-pagination-fraction{bottom:var(--swiper-pagination-bottom,8px);top:var(--swiper-pagination-top,auto);left:0;width:100%}.swiper-pagination-bullets-dynamic{overflow:hidden;font-size:0}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{transform:scale(.33);position:relative}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active{transform:scale(1)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-main{transform:scale(1)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-prev{transform:scale(.66)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-prev-prev{transform:scale(.33)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-next{transform:scale(.66)}.swiper-pagination-bullets-dynamic .swiper-pagination-bullet-active-next-next{transform:scale(.33)}.swiper-pagination-bullet{width:var(--swiper-pagination-bullet-width,var(--swiper-pagination-bullet-size,8px));height:var(--swiper-pagination-bullet-height,var(--swiper-pagination-bullet-size,8px));display:inline-block;border-radius:var(--swiper-pagination-bullet-border-radius,50%);background:var(--swiper-pagination-bullet-inactive-color,#000);opacity:var(--swiper-pagination-bullet-inactive-opacity, .2)}button.swiper-pagination-bullet{border:none;margin:0;padding:0;box-shadow:none;-webkit-appearance:none;appearance:none}.swiper-pagination-clickable .swiper-pagination-bullet{cursor:pointer}.swiper-pagination-bullet:only-child{display:none!important}.swiper-pagination-bullet-active{opacity:var(--swiper-pagination-bullet-opacity, 1);background:var(--swiper-pagination-color,var(--swiper-theme-color))}.swiper-pagination-vertical.swiper-pagination-bullets,.swiper-vertical>.swiper-pagination-bullets{right:var(--swiper-pagination-right,8px);left:var(--swiper-pagination-left,auto);top:50%;transform:translate3d(0px,-50%,0)}.swiper-pagination-vertical.swiper-pagination-bullets .swiper-pagination-bullet,.swiper-vertical>.swiper-pagination-bullets .swiper-pagination-bullet{margin:var(--swiper-pagination-bullet-vertical-gap,6px) 0;display:block}.swiper-pagination-vertical.swiper-pagination-bullets.swiper-pagination-bullets-dynamic,.swiper-vertical>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic{top:50%;transform:translateY(-50%);width:8px}.swiper-pagination-vertical.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet,.swiper-vertical>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{display:inline-block;transition:.2s transform,.2s top}.swiper-horizontal>.swiper-pagination-bullets .swiper-pagination-bullet,.swiper-pagination-horizontal.swiper-pagination-bullets .swiper-pagination-bullet{margin:0 var(--swiper-pagination-bullet-horizontal-gap,4px)}.swiper-horizontal>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic,.swiper-pagination-horizontal.swiper-pagination-bullets.swiper-pagination-bullets-dynamic{left:50%;transform:translateX(-50%);white-space:nowrap}.swiper-horizontal>.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet,.swiper-pagination-horizontal.swiper-pagination-bullets.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{transition:.2s transform,.2s left}.swiper-horizontal.swiper-rtl>.swiper-pagination-bullets-dynamic .swiper-pagination-bullet{transition:.2s transform,.2s right}.swiper-pagination-fraction{color:var(--swiper-pagination-fraction-color,inherit)}.swiper-pagination-progressbar{background:var(--swiper-pagination-progressbar-bg-color,rgba(0,0,0,.25));position:absolute}.swiper-pagination-progressbar .swiper-pagination-progressbar-fill{background:var(--swiper-pagination-color,var(--swiper-theme-color));position:absolute;left:0;top:0;width:100%;height:100%;transform:scale(0);transform-origin:left top}.swiper-rtl .swiper-pagination-progressbar .swiper-pagination-progressbar-fill{transform-origin:right top}.swiper-horizontal>.swiper-pagination-progressbar,.swiper-pagination-progressbar.swiper-pagination-horizontal,.swiper-pagination-progressbar.swiper-pagination-vertical.swiper-pagination-progressbar-opposite,.swiper-vertical>.swiper-pagination-progressbar.swiper-pagination-progressbar-opposite{width:100%;height:var(--swiper-pagination-progressbar-size,4px);left:0;top:0}.swiper-horizontal>.swiper-pagination-progressbar.swiper-pagination-progressbar-opposite,.swiper-pagination-progressbar.swiper-pagination-horizontal.swiper-pagination-progressbar-opposite,.swiper-pagination-progressbar.swiper-pagination-vertical,.swiper-vertical>.swiper-pagination-progressbar{width:var(--swiper-pagination-progressbar-size,4px);height:100%;left:0;top:0}.swiper-pagination-lock{display:none}.swiper-scrollbar{border-radius:var(--swiper-scrollbar-border-radius,10px);position:relative;touch-action:none;background:var(--swiper-scrollbar-bg-color,rgba(0,0,0,.1))}.swiper-scrollbar-disabled>.swiper-scrollbar,.swiper-scrollbar.swiper-scrollbar-disabled{display:none!important}.swiper-horizontal>.swiper-scrollbar,.swiper-scrollbar.swiper-scrollbar-horizontal{position:absolute;left:var(--swiper-scrollbar-sides-offset,1%);bottom:var(--swiper-scrollbar-bottom,4px);top:var(--swiper-scrollbar-top,auto);z-index:50;height:var(--swiper-scrollbar-size,4px);width:calc(100% - 2 * var(--swiper-scrollbar-sides-offset,1%))}.swiper-scrollbar.swiper-scrollbar-vertical,.swiper-vertical>.swiper-scrollbar{position:absolute;left:var(--swiper-scrollbar-left,auto);right:var(--swiper-scrollbar-right,4px);top:var(--swiper-scrollbar-sides-offset,1%);z-index:50;width:var(--swiper-scrollbar-size,4px);height:calc(100% - 2 * var(--swiper-scrollbar-sides-offset,1%))}.swiper-scrollbar-drag{height:100%;width:100%;position:relative;background:var(--swiper-scrollbar-drag-bg-color,rgba(0,0,0,.5));border-radius:var(--swiper-scrollbar-border-radius,10px);left:0;top:0}.swiper-scrollbar-cursor-drag{cursor:move}.swiper-scrollbar-lock{display:none}.swiper-zoom-container{width:100%;height:100%;display:flex;justify-content:center;align-items:center;text-align:center}.swiper-zoom-container>canvas,.swiper-zoom-container>img,.swiper-zoom-container>svg{max-width:100%;max-height:100%;object-fit:contain}.swiper-slide-zoomed{cursor:move;touch-action:none}.swiper .swiper-notification{position:absolute;left:0;top:0;pointer-events:none;opacity:0;z-index:-1000}.swiper-free-mode>.swiper-wrapper{transition-timing-function:ease-out;margin:0 auto}.swiper-grid>.swiper-wrapper{flex-wrap:wrap}.swiper-grid-column>.swiper-wrapper{flex-wrap:wrap;flex-direction:column}.swiper-fade.swiper-free-mode .swiper-slide{transition-timing-function:ease-out}.swiper-fade .swiper-slide{pointer-events:none;transition-property:opacity}.swiper-fade .swiper-slide .swiper-slide{pointer-events:none}.swiper-fade .swiper-slide-active{pointer-events:auto}.swiper-fade .swiper-slide-active .swiper-slide-active{pointer-events:auto}.swiper.swiper-cube{overflow:visible}.swiper-cube .swiper-slide{pointer-events:none;-webkit-backface-visibility:hidden;backface-visibility:hidden;z-index:1;visibility:hidden;transform-origin:0 0;width:100%;height:100%}.swiper-cube .swiper-slide .swiper-slide{pointer-events:none}.swiper-cube.swiper-rtl .swiper-slide{transform-origin:100% 0}.swiper-cube .swiper-slide-active,.swiper-cube .swiper-slide-active .swiper-slide-active{pointer-events:auto}.swiper-cube .swiper-slide-active,.swiper-cube .swiper-slide-next,.swiper-cube .swiper-slide-prev{pointer-events:auto;visibility:visible}.swiper-cube .swiper-cube-shadow{position:absolute;left:0;bottom:0px;width:100%;height:100%;opacity:.6;z-index:0}.swiper-cube .swiper-cube-shadow:before{content:'';background:#000;position:absolute;left:0;top:0;bottom:0;right:0;filter:blur(50px)}.swiper-cube .swiper-slide-next+.swiper-slide{pointer-events:auto;visibility:visible}.swiper-cube .swiper-slide-shadow-cube.swiper-slide-shadow-bottom,.swiper-cube .swiper-slide-shadow-cube.swiper-slide-shadow-left,.swiper-cube .swiper-slide-shadow-cube.swiper-slide-shadow-right,.swiper-cube .swiper-slide-shadow-cube.swiper-slide-shadow-top{z-index:0;-webkit-backface-visibility:hidden;backface-visibility:hidden}.swiper.swiper-flip{overflow:visible}.swiper-flip .swiper-slide{pointer-events:none;-webkit-backface-visibility:hidden;backface-visibility:hidden;z-index:1}.swiper-flip .swiper-slide .swiper-slide{pointer-events:none}.swiper-flip .swiper-slide-active,.swiper-flip .swiper-slide-active .swiper-slide-active{pointer-events:auto}.swiper-flip .swiper-slide-shadow-flip.swiper-slide-shadow-bottom,.swiper-flip .swiper-slide-shadow-flip.swiper-slide-shadow-left,.swiper-flip .swiper-slide-shadow-flip.swiper-slide-shadow-right,.swiper-flip .swiper-slide-shadow-flip.swiper-slide-shadow-top{z-index:0;-webkit-backface-visibility:hidden;backface-visibility:hidden}.swiper-creative .swiper-slide{-webkit-backface-visibility:hidden;backface-visibility:hidden;overflow:hidden;transition-property:transform,opacity,height}.swiper.swiper-cards{overflow:visible}.swiper-cards .swiper-slide{transform-origin:center bottom;-webkit-backface-visibility:hidden;backface-visibility:hidden;overflow:hidden}
    </style>




    <div class="slider-wrapper">

    <div class="swiper mySwiper">
      <div class="swiper-wrapper">
        <div class="swiper-slide">
          <div class="bill-header">
            <div>City of Ottawa</div>
            <div>February 5<sup>th</sup>, 2025</div>
            <div> ACS2025-OCC-CCS-0002         </div>
            <div class="bill-number">  Councillor Jeff Leiper            </div>
          </div>
          <h2>Motion: Shelter Use in all Zones</h2>
          <p>
          Whereas the Official Plan calls for shelters in all urban zones; and,<br />
          Whereas outdated zoning still blocks shelters in many areas; and,<br />
          Whereas delays risk missing new funding and worsen the housing crisis;<br /><br />
          </p>
          <p>           <em>Therefore be it resolved that</em> shelters be permitted in all urban zones immediately, using the current definition in By-law 2008-250 until updated.<br /><br />
          </p>
          <div class="impacts">
            <p>Should this motion pass, the City anticipates the following impacts:</p>
            <ul>
              <li><p>Increased system capacity</p></li>
              <li><p>Decreased unsheltered inflow</p></li>
              <li><p>Enabling access to time-sensitive federal/provincial funding</p></li>
            </ul>
          </div>
          <div class="meta">
            Planning and Housing Committee
          </div>
        </div>
        <div class="swiper-slide">
  <div class="bill-header">
    <div>City of Ottawa</div>
    <div>ACS2024-OCC-CCS-0045</div>
    <div class="bill-number">Councillor Ariel Troster</div>
  </div>
  <h2>Motion: Renovictions</h2>
  <p>
  Whereas renovictions are displacing tenants and eroding affordable housing, and the City must act in the absence of sufficient provincial enforcement; and,<br />
  Whereas the City of Hamilton has adopted Ontario’s first anti-renoviction by-law with licensing and enforcement measures;<br /><br />
</p>
  <p>
    <em>Therefore be it resolved that</em> landlords are required to obtain a renovation license, prove necessity for vacant possession, and provide relocation assistance for affected tenants.
  </p>
  <div class="impacts">
    <p>Should this motion pass, the City anticipates the following impacts:</p>
    <ul>
      <li><p>Reduced eviction-driven inflow</p></li>
      <li><p>Preservation of existing affordable units</p></li>
    </ul>
  </div>
  <div class="meta">
    Planning and Housing Committee
  </div>
</div>
<div class="swiper-slide">
<div class="bill-header">
  <div>City of Ottawa</div>
  <div>November 20<sup>th</sup>, 2024</div>
  <div> ACS2024- OCC-CCS- 0035</div>
  <div class="bill-number">Councillor Laine Johnson</div>
</div>
<h2>Motion: Affordable Housing Acquisition Fund</h2>
<p>
  Whereas the City is losing affordable housing faster than it can build new supply; and,<br />
  Whereas acquisition funds in cities like Toronto and Montreal have helped preserve affordable units through non-profit ownership; and,<br />
  Whereas relying solely on new construction risks missing opportunities to protect existing stock;<br /><br />
</p>
<p>
  <em>Therefore be it resolved that</em> the City allocate surplus revenues from the Vacant Unit Tax to establish an acquisition fund for the preservation of at-risk affordable housing.
</p>
<div class="impacts">
  <p>Should this motion pass, the City anticipates the ability to further protect and maintain existing affordable units.</p>
</div>
<div class="meta">
  Planning and Housing Committee
</div>
</div>
<div class="swiper-slide">
<div class="bill-header">
  <div>City of Ottawa</div>
  <div>March 2024</div>
  <div>Motion No. 2024-32-11</div>
  <div class="bill-number">Councillor Ariel Troster</div>
</div>
<h2>Motion: Leasing Office Space for Transitional Housing</h2>
<p>
Whereas unprecedented shelter demand has forced the use of recreation centres as overflow sites, which must return to public use; and,<br />
  Whereas commercial properties present an opportunity to rapidly expand transitional housing capacity; 
</p>
<p>
<em>Therefore be it resolved that</em> Council approve long-term leases to convert vacant office space into transitional housing, with capital support for renovations.
</p>
<div class="impacts">
  <p>Should this motion pass, the City anticipates the following impacts:</p>
  <ul>
    <li><p>Increased transitional housing capacity</p></li>
    <li><p>Reduced reliance on emergency overflow centres</p></li>
    <li><p>More dignified interim housing for shelter clients</p></li>
  </ul>
</div>
<div class="meta">
  Emergency Shelter Crisis Taskforce
</div>
</div>
        <div class="swiper-slide">
          <div class="bill-header">
            <div>117<sup>th</sup> Congress</div>
            <div>1<sup>st</sup> Session</div>
            <div class="bill-number">H.R. 2077</div>
          </div>
          <h2>Bill 5</h2>
          <p>
            Be it enacted by the Senate and House of Representatives of the
            United States of America in Congress assembled:<br /><br />
            <em>Section 1. Short title.</em><br />
            This Act may be cited as the “Student Debt Relief Act.”<br /><br />
            <em>Section 2. Purpose.</em><br />
            (1) To provide relief for federal student loan borrowers.<br />
            (2) <em>Additional provisions to be inserted…</em>
          </p>
          <div class="meta">
            Sponsor: Rep. Linda Tran | Introduced: February 28, 2025
          </div>
        </div>
        <div class="swiper-slide">
          <div class="bill-header">
            <div>117<sup>th</sup> Congress</div>
            <div>1<sup>st</sup> Session</div>
            <div class="bill-number">S. 3890</div>
          </div>
          <h2>Bill 6</h2>
          <p>
            Be it enacted by the Senate and House of Representatives of the
            United States of America in Congress assembled:<br /><br />
            <em>Section 1. Short title.</em><br />
            This Act may be cited as the “Climate Resilience Infrastructure
            Act.”<br /><br />
            <em>Section 2. Findings.</em><br />
            (1) Infrastructure must be modernized to withstand climate
            change.<br />
            (2) <em>Further findings to be inserted…</em>
          </p>
          <div class="meta">
            Sponsor: Sen. Priya Patel | Introduced: January 30, 2025
          </div>
        </div>
        <div class="swiper-slide">
          <div class="bill-header">
            <div>117<sup>th</sup> Congress</div>
            <div>1<sup>st</sup> Session</div>
            <div class="bill-number">H.R. 9999</div>
          </div>
          <h2>Bill 7</h2>
          <p>
            Be it enacted by the Senate and House of Representatives of the
            United States of America in Congress assembled:<br /><br />
            <em>Section 1. Short title.</em><br />
            This Act may be cited as the “Universal Childcare Access Act.”<br /><br />
            <em>Section 2. Purpose.</em><br />
            (1) To expand access to affordable childcare services.<br />
            (2) <em>Further provisions to be inserted…</em>
          </p>
          <div class="meta">
            Sponsor: Rep. Samuel Green | Introduced: March 2, 2025
          </div>
        </div>
        <div class="swiper-slide">
          <div class="bill-header">
            <div>117<sup>th</sup> Congress</div>
            <div>1<sup>st</sup> Session</div>
            <div class="bill-number">S. 1010</div>
          </div>
          <h2>Bill 8</h2>
          <p>
            Be it enacted by the Senate and House of Representatives of the
            United States of America in Congress assembled:<br /><br />
            <em>Section 1. Short title.</em><br />
            This Act may be cited as the “Healthcare Equity Advancement Act.”<br /><br />
            <em>Section 2. Findings.</em><br />
            (1) Persistent disparities exist in healthcare access and
            outcomes.<br />
            (2) <em>Additional findings to be inserted…</em>
          </p>
          <div class="meta">
            Sponsor: Sen. Emily Carter | Introduced: January 15, 2025
          </div>
        </div>
        <div class="swiper-slide">
          <div class="bill-header">
            <div>117<sup>th</sup> Congress</div>
            <div>1<sup>st</sup> Session</div>
            <div class="bill-number">H.R. 8888</div>
          </div>
          <h2>Bill 9</h2>
          <p>
            Be it enacted by the Senate and House of Representatives of the
            United States of America in Congress assembled:<br /><br />
            <em>Section 1. Short title.</em><br />
            This Act may be cited as the “Small Business Recovery Act.”<br /><br />
            <em>Section 2. Purpose.</em><br />
            (1) To support small businesses in recovering from economic
            downturns.<br />
            (2) <em>Further provisions to follow…</em>
          </p>
          <div class="meta">
            Sponsor: Rep. Olivia Brown | Introduced: February 10, 2025
          </div>
        </div>
      </div>
    </div>

    <div style="display: flex; flex-direction: column; align-items: center; margin-top: 2em;">
  <<button "Adopt">>
    <<run (()=>{
      const map = [
        "Bill 1",
        "Bill 2",
        "Bill 3",
        "Bill 4"
      ];
      // get the active slide index
      const idx = window.mySwiper.activeIndex;
      // play the corresponding passage
      Engine.play(map[idx]);
    })()>>
  <</button>>
</div>
</div>
    </div>
<div style="display: none;">
  * [[Emergency Shelter Expansion ($30M)|Bill 1]]  
  * [[Housing First Pilot ($50M)|Bill 2]]  
  * [[Frontline Mental Health + Addiction Support ($40M)|Bill 3]]  
  * [[Lived Experience Consultation & Strategic Planning ($10M)|Bill 4]]  
</div>



:: Dish out funding {"position":"800,1175","size":"100,100"}
<<set $turn += 1>>
<<script>>window.PolicyManager.tick();<</script>>

<div class="passageContent">
  <h2>Fund Local Services</h2>
  <p>You have <strong>$<<= $budget >>M</strong> to distribute among the following Ottawa initiatives:</p>

  <div>
    <label for="salvation">The Salvation Army</label>
    <input type="range" id="salvation" min="0" max="100" step="1" value="0">
    <span id="salvation-val">0</span>M
  </div>

  <div>
    <label for="shepherd">Good Shepherd Ministries</label>
    <input type="range" id="shepherd" min="0" max="100" step="1" value="0">
    <span id="shepherd-val">0</span>M
  </div>

  <div>
    <label for="felix">St. Felix Centre</label>
    <input type="range" id="felix" min="0" max="100" step="1" value="0">
    <span id="felix-val">0</span>M
  </div>

  <hr>
  <p><strong>Total Allocated:</strong> <span id="total">0</span>M of $<<= $budget >>M</p>
  <p id="warning" style="color: red; display: none;">⚠️ You've reached your funding limit.</p>

  <p>* [[Continue|Event1]]</p>
</div>
<<script>>
$(document).on(':passagedisplay', function () {
  setTimeout(() => {
    const maxBudget = State.variables.budget;
    const sliders = ['salvation', 'shepherd', 'felix'];

    function updateFunding() {
      let total = 0;

      sliders.forEach(id => {
        const val = parseInt(document.getElementById(id).value, 10);
        total += val;
      });

      // Enforce budget cap
      if (total > maxBudget) {
        document.getElementById('warning').style.display = 'block';

        const active = document.activeElement;
        if (sliders.includes(active.id)) {
          const overage = total - maxBudget;
          const curVal = parseInt(active.value, 10);
          const newVal = curVal - overage;
          active.value = Math.max(newVal, 0);
          total -= overage;
        }
      } else {
        document.getElementById('warning').style.display = 'none';
      }

      // Update visuals
      sliders.forEach(id => {
        document.getElementById(id + '-val').textContent = document.getElementById(id).value;
      });
      document.getElementById('total').textContent = total;
    }

    sliders.forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        el.addEventListener('input', updateFunding);
      }
    });
  }, 0);
});
<</script>>


:: Event1 {"position":"450,1125","size":"100,100"}
<<set $turn += 1>>
  <<script>>window.PolicyManager.tick();<</script>>
  
  <style>
  $font-header: "Pirata One", cursive;
  $font-body: "Merriweather", serif;
  $col-black: #2a2d2f;
  
  
  
  @keyframes roller {
    from {
      background-position: 0 0;
    }
    to {
      background-position: 0 200vh;
    }
  }
  
  @keyframes paper-spin {
    from {
      transform: rotate(-360deg) scale(0.3) translateZ(0);
      filter: blur(3px);
    }
    to {
      transform: rotate(8deg) scale(1) translateZ(0);
    }
  }
  
  .paper-stack {
    position: relative;
    width: 58.5vw;
    height: 45vw;
    margin-left: auto;
    margin-right: auto;
    transform-origin: center center;
    animation: paper-spin cubic-bezier(0.86, 0, 0.07, 1)s linear forwards;
    transform: rotate(8deg); /* final position */
  }
  
  .page,
  .newspaper {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    padding: 4px;
    height: 100%;
    background: white;
    border: 1.5px solid rgba(0, 0, 0, 0.48);
    backface-visibility: hidden;
  }
  
  /* Background blank pages */
  .page-1 {
    z-index: 1;
    transform: translate(-12px, -12px);
  }
  
  .page-2 {
    z-index: 2;
    transform: translate(-6px, -6px);
  }
  
  /* Main newspaper layout */
  .newspaper {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 1fr;
    grid-template-rows: 15% 24% auto;
    z-index: 3;
    //display: none; // optional
  }
  
  .title {
    grid-column: 1 / 5;
    grid-row: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    border-bottom: 4px solid $col-black;
  }
  
  .headline {
    grid-column: 1 / 5;
    grid-row: 2;
  }
  
  .coverimage {
    grid-column: 3 / 5;
    grid-row: 3 / 5;
    padding: 0 0.5rem;
  
    img {
      width: 100%;
      height: 28vw;
      object-fit: cover;
    }
  }
  
  .copy {
    grid-column: 1 / 3;
    grid-row: 3 / 5;
    column-count: 2;
    padding: 1vw;
    font-family: "Domine", serif;
    font-weight: 400;
  }
  
  h1 {
    font-family: "Domine", serif;
    font-weight: 700;
    font-size: 4.8vw;
    margin: 0;
  }
  
  h2 {
    font-family: "Domine", serif;
    font-weight: 700;
    text-transform: uppercase;
    font-size: 4vw;
    margin: 0;
    text-align: center;
    line-height: 1.1;
  }
  
  p {
    font-family: "Domine", serif;
    font-weight: 400;
    font-size: 1vw;
    line-height: 1.2;
    margin: 0;
  }
  
  .pullquote {
    font-family: "Domine", serif;
    font-weight: 400;
    font-size: 1.2vw;
    border-top: 0.2vw solid $col-black;
    border-bottom: 0.2vw solid $col-black;
    margin: 1vw 0;
    padding: 1vw 0;
  }
  
  button {
    padding: 0.5rem 1rem;
    position: absolute;
    bottom: 1em;
    right: 1rem;
    z-index: 4;
    background: #0b310a;
    color: white;
    border: 1px solid white;
    font-size: 1.2rem;
    font-family: $font-body;
  }
  </style>
  <div class="passageContent">
  
  <div class="paper-stack playing">
    <!-- Blank pages behind -->
    <div class="page page-1"></div>
    <div class="page page-2"></div>
  
    <!-- Actual front page -->
    <div class="newspaper">
      <div class="title">
        <h1>The Daily Sun</h1>
      </div>
  
      <div class="headline">
        <h2>Local Paperboy Swept-Up By Mini Tornado</h2>
      </div>
  
      <div class="coverimage">
        <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/96252/bike.jpg" alt="Paperboy on bike">
      </div>
  
      <div class="copy">
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.</p>
  
        <p>Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
  
        <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.</p>
  
        <p class="pullquote">Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur.</p>
  
        <p>Adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem. Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam?</p>
      </div>
    </div>
  </div>
  
  
  
  
  
    <h2>!!!</h2>
    <p>
      It's mid-July and your city is experiencing an extreme heat wave. Temperatures are topping 40°C with high humidity. Shelters are over capacity, cooling centers are limited, and unhoused residents are reporting heat-related illness.
    </p>
  
    <p><strong>Select all the actions you want to take:</strong></p>
  
    <form id="heatwave-form">
      <ul>
        <li>
          <label>
            <input type="checkbox" name="response" value="cooling_centres">
            Open temporary cooling centres
          </label>
        </li>
        <li>
          <label>
            <input type="checkbox" name="response" value="water_kits">
            Distribute water & hygiene kits via outreach
          </label>
        </li>
        <li>
          <label>
            <input type="checkbox" name="response" value="transport_passes">
            Provide transit passes for access to indoor spaces
          </label>
        </li>
        <li>
          <label>
            <input type="checkbox" name="response" value="hotel_vouchers">
            Issue hotel vouchers to medically vulnerable people
          </label>
        </li>
      </ul>
    </form>
  
  
    <p id="error-msg" style="color: red; display: none;">Please select at least one option before continuing.</p>
    <p>* [[Continue|PIT]]</p>
  
  </div>
  


:: NewArrivalKits {"position":"1200,1225","size":"100,100"}
<<script>>
PolicyManager.register({
  name: "Renoviction Awareness",
  costUpfront: 4,
  costPerTurn: 1,
  duration: 3, // heavy up-front push

  immediate(v) {
  },

  tick(v, Util, age) {
    // Nothing for now
  }
});
<</script>>

<div class="passageContent"> 
<p>Info </p>

[[Continue|Dish out funding]]
</div>



:: NextYear {"position":"625,1475","size":"100,100"}
<<set $turn += 1>>
<<set $year += 1>>

<div class="passageContent"> 
<h2>End of Year 2024 Summary</h2>

<p>After twelve months under your chosen strategy:</p>
<ul>
 <li><strong>Total Homeless Population:</strong> <<= $homelessTotal >> (change of <<= Math.round((($homelessTotal - 2952)/2952)*100) >>%)</li>
    <li><strong>Budget Remaining:</strong> $<<print $budget>>M</li>
    <li><strong>Public Trust:</strong> <<= $publicOpinion >></li>
    <li><strong>Service Coordination:</strong> <<= $systemCoordination >></li>
    <li><strong>System Capacity:</strong> <<= $systemCapacity >></li>
    <li><strong>Political Capital:</strong> <<= $politicalCapital >></li>
</ul>

<p>
  You’ve done ...... and ...... to .....
</p>

<p>
</p>
</div>



:: PIT {"position":"625,1275","size":"100,100"}
<<set $turn += 1>>

<<script>>window.PolicyManager.tick();<</script>>

<div class="passageContent">
  <h2>📍 Point-in-Time Snapshot, 2024</h2>
  <p>This report reflects the current state of homelessness and system readiness. </p>

 
  <h3>🏠</h3>
  <ul>
    <li><strong>Unsheltered:</strong> <<= $pop.unsheltered >></li>
    <li><strong>Sheltered:</strong> <<= $pop.sheltered >></li>
    <li><strong>Transitional Housing:</strong> <<= $pop.transitional >></li>
    <li><strong>Institutional Settings:</strong> <<= $pop.institutional >></li>
    <li><strong>Chronically Homeless:</strong> <<= $pop.chronic >></li>
    <li><strong>With Children:</strong> <<= $pop.withChildren >></li>
    <li><strong>Foster Care History:</strong> <<= $pop.fosterCareHistory >></li>
  </ul>

  <h3>🧑‍🤝‍🧑</h3>
  <ul>
    <li><strong>Male:</strong> <<= $pop.male >></li>
    <li><strong>Female:</strong> <<= $pop.female >></li>
    <li><strong>Trans / Non-binary:</strong> <<= $pop.transNB >></li>
    <li><strong>Age 25–49:</strong> <<= $pop.age25to49 >></li>
    <li><strong>LGBQ:</strong> <<= $pop.lgbq >></li>
    <li><strong>LGBTQ+ Youth:</strong> <<= $pop.lgbtqYouth >></li>
    <li><strong>Racialized:</strong> <<= $pop.racialized >></li>
    <li><strong>Indigenous:</strong> <<= $pop.indigenous >></li>
    <li><strong>Veterans:</strong> <<= $pop.veteran >></li>
    <li><strong>Immigrants / Refugees:</strong> <<= $pop.immigrant >></li>
  </ul>

  <p><em>This snapshot will help guide your next set of decisions in the evolving response. </em></p>

  <p>📌 [[Continue|NextYear]]</p>
    <p>📌 [[PIT1|PointInTime1]]</p>

</div>


:: PointInTime1 {"position":"750,1400","size":"100,100"}
  <div class="passage-content">

  <div class="chart-section">
    <h3>Housing Status Change</h3>
    <canvas id="housingStackedBar" height="150"></canvas>
  </div>

  <div class="chart-section">
    <h3>Homelessness Trend</h3>
    <canvas id="homelessLineChart" height="150"></canvas>
  </div>

  <div class="chart-section">
    <h3>Identity Demographics</h3>
    <div id="identityMetrics"></div>
  </div>

  <<script>>
  $(document).one(':passagedisplay', function(ev) {
    const V = State.variables;
    const hist = V.history || [];

    if (!hist.length) {
      return;
    }

    // — pick snapshots —
    const before = hist[0];
    const after  = hist[1] || null;
    console.log("▶️ before snapshot:", before);
    if (after) console.log("▶️ after snapshot:", after);

    // — 1. Stacked Bar for Housing Status —
    (function() {
      const ctx = document.getElementById('housingStackedBar').getContext('2d');
      const cats = ['unsheltered','sheltered','transitional','institutional'];
      const colors = ['#FF6384','#36A2EB','#FFCE56','#4BC0C0'];

      // dynamically build labels
      const labels = [`Year ${before.year}`];
      if (after) labels.push(`Year ${after.year}`);

      // build datasets
      const datasets = cats.map((key,i) => {
        const arr = [ before.pop[key]/before.homelessTotal ];
        if (after) arr.push(after.pop[key]/after.homelessTotal);
        return {
          label: key.charAt(0).toUpperCase()+key.slice(1),
          data: arr,
          backgroundColor: colors[i]
        };
      });


      new Chart(ctx, {
        type: 'bar',
        data: { labels, datasets },
        options: {
          responsive: true,
          scales: {
            x: { stacked: true },
            y: {
              stacked: true,
              ticks: { callback: v => (v*100).toFixed(0) + '%' }
            }
          },
          plugins: {
            tooltip: {
              callbacks: {
                label: ctx => `${ctx.dataset.label}: ${(ctx.parsed.y*100).toFixed(1)}%`
              }
            }
          }
        }
      });
    })();

    // — 2. Line Chart for Total Homeless Trend —
    (function() {
      const ctx = document.getElementById('homelessLineChart').getContext('2d');
      const labels = hist.map(s => `Year ${s.year}`);
      const data   = hist.map(s => s.homelessTotal);



      // gradient
      const grad = ctx.createLinearGradient(0,0,0,300);
      grad.addColorStop(0, 'rgba(54,162,235,0.5)');
      grad.addColorStop(1, 'rgba(54,162,235,0)');

      new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [{
            label: 'Total Homeless',
            data,
            fill: true,
            backgroundColor: grad,
            borderColor: 'rgba(54,162,235,1)',
            tension: 0.4,
            pointRadius: 3
          }]
        },
        options: {
          responsive: true,
          animation: { duration: 1500 }
        }
      });
    })();

    // — 3. Identity Demographics with Arrows —
    (function() {
      const container = document.getElementById('identityMetrics');
      container.innerHTML = '';
      const keys = [
        'male','female','transNB','lgbq','lgbtqYouth',
        'age25to49','racialized','indigenous','veteran','immigrant'
      ];

      keys.forEach(key => {
        const bShare = before.pop[key]/before.homelessTotal;
        const aShare = after ? after.pop[key]/after.homelessTotal : bShare;
        const arrow  = after
          ? aShare > bShare ? '↑'
            : aShare < bShare ? '↓'
            : '→'
          : '';
        console.log(` ${key}: before ${(bShare*100).toFixed(1)}%, after ${(aShare*100).toFixed(1)}%, arrow ${arrow}`);

        const label = key === 'transNB' ? 'Trans & NB'
          : key.charAt(0).toUpperCase() + key.slice(1);

        const p = document.createElement('p');
        p.textContent = `${label}: ${(aShare*100).toFixed(1)}% ${arrow}`;
        container.appendChild(p);
      });
    })();

  });
  <</script>>



:: PreServiceFunding {"position":"600,800","size":"100,100"}
<!-- CSS Styling -->
<style>
  .build-intro {
    max-width: 700px;
    margin: 0 auto;
    padding: 40px 20px;
    text-align: center;
    font-size: 1.2em;
    margin-top: 5rem;
    line-height: 1.6;
    margin-bottom: 2rem;
    color: #1c1c1e;
  }
.button {
  background-color: #ffffff !important;
  color: #111827 !important;
  border: 1px solid #e5e7eb !important;
  padding: 0.5rem 0.75rem !important;
  border-radius: 0.5rem !important;
  font-size: 0.875rem !important;
  font-weight: 500 !important;
  line-height: 1.25 !important;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05) !important;
  cursor: pointer !important;
  transition: all 0.2s ease-in-out !important;
  margin: 0.3rem auto; /* centers it */
  display: block;
  text-align: center !important;
}
</style>

<!-- Intro Text -->
<div class="passage-content">
  <div class="build-intro">
    <p>
      Now that key policies are in motion, it’s time to decide how to support them.
      From shelters to tenant services to housing outreach, your budget shapes what actually gets delivered — and how well it works.
    </p>
    <p>
      These services don’t always align perfectly. Now it’s your job to allocate funds to each one — and decide what role they’ll play in the years ahead.
    </p>
    <button class="button" onclick="SugarCube.Engine.play('ServiceFunding1')">Fund Services</button>
  </div>
</div>


:: QuarterFour {"position":"75,1300","size":"100,100"}
<<set $turn += 1>>
<<script>>window.PolicyManager.tick();<</script>>

<div class="passageContent"> 
  <h2>Quarter 4 Report</h2>

  <p><strong>Year:</strong> <<= $year >></p>
  <ul>
    <li><strong>Budget Remaining:</strong> $<<print $budget>>M</li>
    <li><strong>Public Trust:</strong> <<print $publicOpinion>></li>
    <li><strong>Service Coordination:</strong> <<print $serviceCoordination>></li>
    <li><strong>Staff Morale:</strong> <<print $staffMorale>></li>
    <li><strong>System Capacity:</strong> <<print $systemCapacity>></li>
    <li><strong>Political Capital:</strong> <<print $politicalCapital>></li>
    <li><strong>Total Homeless Population:</strong> <<print $homelessTotal>></li>
  </ul>

  <p><em>You’ve completed one full year of strategy implementation.</em></p>

  <p>
    <strong>→</strong> [[See End-of-Year Summary|QuarterTwo]]
  </p>
</div>


:: QuarterThree {"position":"175,1100","size":"100,100"}
<<set $turn += 1>>
<<script>>window.PolicyManager.tick();<</script>>

<div class="passageContent"> 
  <h2>Quarter 3 Report</h2>

  <p><strong>Year:</strong> <<= $year >></p>
  <ul>
    <li><strong>Budget Remaining:</strong> $<<print $budget>>M</li>
    <li><strong>Public Trust:</strong> <<print $publicOpinion>></li>
    <li><strong>Service Coordination:</strong> <<print $serviceCoordination>></li>
    <li><strong>Staff Morale:</strong> <<print $staffMorale>></li>
    <li><strong>System Capacity:</strong> <<print $systemCapacity>></li>
    <li><strong>Political Capital:</strong> <<print $politicalCapital>></li>
    <li><strong>Total Homeless Population:</strong> <<print $homelessTotal>></li>
  </ul>

  <p>
    <strong>→</strong> [[Proceed to Q4|QuarterFour]]
  </p>
</div>


:: QuarterTwo {"position":"0,1100","size":"100,100"}
<<script>>window.PolicyManager.tick();<</script>>

<div class="passageContent"> 
  <h2>Quarter 2 Report</h2>

  <p><strong>Year:</strong> <<= $year >></p>
  <ul>
    <li><strong>Budget Remaining:</strong> $<<print $budget>>M</li>
    <li><strong>Public Trust:</strong> <<print $publicOpinion>></li>
    <li><strong>Service Coordination:</strong> <<print $serviceCoordination>></li>
    <li><strong>Staff Morale:</strong> <<print $staffMorale>></li>
    <li><strong>System Capacity:</strong> <<print $systemCapacity>></li>
    <li><strong>Political Capital:</strong> <<print $politicalCapital>></li>
    <li><strong>Total Homeless Population:</strong> <<print $homelessTotal>></li>
  </ul>

  <p>
    <strong>→</strong> [[Proceed to Q3|QuarterThree]]
  </p>
</div>


:: RenovictionAwareness {"position":"1300,1050","size":"100,100"}
<<script>>
PolicyManager.register({
  name: "Renoviction Awareness",
  costUpfront: 4,
  costPerTurn: 1,
  duration: 3, // heavy up-front push

  immediate(v) {
  },

  tick(v, Util, age) {
    // Nothing for now
  }
});
<</script>>

<div class="passageContent"> 
<p>Info </p>

[[Continue|Dish out funding]]
</div>



:: ServiceFunding1 {"position":"600,900","size":"100,100"}
<div class="puzzle-layout">
    <div id="game-area">
      <!-- The plugin will create its canvas inside this div -->
    </div>
    <div class="controls-panel">
      <!-- Budget Meter -->
      <div
        class="balance-meter"
        id="budget-meter"
        data-unit="currency"
        style="top: 0px"
      >
        <div class="title">Budget Allocated</div>
        <div
          style="
            border-top: 1px dashed #cccccc;
            margin-top: 8px;
            padding-top: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
          "
        >
          <div>
            <button
              id="inner-square-decrease"
              class="control-btn"
              title="Decrease Size"
            >
              -
            </button>
            <span class="dollar-sign">$</span>
            <span class="digits2" id="budget-val">100</span>M
            <button
              id="inner-square-increase"
              class="control-btn"
              title="Increase Size"
            >
              +
            </button>
          </div>
          <button id="submit-button" class="submit-btn" disabled>
            Submit
          </button>
        </div>
      </div>
      <div id="selected-piece-controls-group">
        <div class="title" id="selected-piece-id">
          Click a service on the grid to select it.
        </div>
        <div
          style="
            border-top: 1px dashed #cccccc;
            margin-top: 8px;
            padding-top: 5px;
          "
        >
          <div id="selected-piece-info" style="display: none">
            <div class="control-group">
              <button
                id="piece-transform-prev"
                class="control-btn"
                title="Previous Shape"
              >
                -
              </button>
              <span
                class="dollar-sign"
                id="piece-value-symbol"
                style="font-weight: 600; font-size: 32px"
                >¢</span
              >
              <button
                id="piece-transform-next"
                class="control-btn"
                title="Next Shape"
              >
                +
              </button>
            </div>
          </div>
          <div id="selected-piece-description" style="display: none; font-size: 0.9em; margin-top: 8px; color: #555;">
            <!-- dynamically filled description -->
          </div>

          <p style="font-size: 0.8em; margin-top: 10px">
            Press 'R' to rotate the selected piece.
          </p>
        </div>
      </div>
    </div>
  </div>
  <<script>>
    // jQuery Widget (no changes needed, include as is from iteration 1)
    (function (e) {
      "function" == typeof define && define.amd
        ? define(["jquery"], e)
        : e(jQuery);
    })(function (e) {
      var t = 0,
        i = Array.prototype.slice;
      (e.cleanData = (function (t) {
        return function (i) {
          var s, n, a;
          for (a = 0; null != (n = i[a]); a++)
            try {
              (s = e._data(n, "events")),
                s && s.remove && e(n).triggerHandler("remove");
            } catch (o) {}
          t(i);
        };
      })(e.cleanData)),
        (e.widget = function (t, i, s) {
          var n,
            a,
            o,
            r,
            h = {},
            l = t.split(".")[0];
          return (
            (t = t.split(".")[1]),
            (n = l + "-" + t),
            s || ((s = i), (i = e.Widget)),
            (e.expr[":"][n.toLowerCase()] = function (t) {
              return !!e.data(t, n);
            }),
            (e[l] = e[l] || {}),
            (a = e[l][t]),
            (o = e[l][t] =
              function (e, t) {
                return this._createWidget
                  ? (arguments.length && this._createWidget(e, t), void 0)
                  : new o(e, t);
              }),
            e.extend(o, a, {
              version: s.version,
              _proto: e.extend({}, s),
              _childConstructors: [],
            }),
            (r = new i()),
            (r.options = e.widget.extend({}, r.options)),
            e.each(s, function (t, s) {
              return e.isFunction(s)
                ? ((h[t] = (function () {
                    var e = function () {
                        return i.prototype[t].apply(this, arguments);
                      },
                      n = function (e) {
                        return i.prototype[t].apply(this, e);
                      };
                    return function () {
                      var t,
                        i = this._super,
                        a = this._superApply;
                      return (
                        (this._super = e),
                        (this._superApply = n),
                        (t = s.apply(this, arguments)),
                        (this._super = i),
                        (this._superApply = a),
                        t
                      );
                    };
                  })()),
                  void 0)
                : ((h[t] = s), void 0);
            }),
            (o.prototype = e.widget.extend(
              r,
              { widgetEventPrefix: a ? r.widgetEventPrefix || t : t },
              h,
              {
                constructor: o,
                namespace: l,
                widgetName: t,
                widgetFullName: n,
              }
            )),
            a
              ? (e.each(a._childConstructors, function (t, i) {
                  var s = i.prototype;
                  e.widget(s.namespace + "." + s.widgetName, o, i._proto);
                }),
                delete a._childConstructors)
              : i._childConstructors.push(o),
            e.widget.bridge(t, o),
            o
          );
        }),
        (e.widget.extend = function (t) {
          for (
            var s, n, a = i.call(arguments, 1), o = 0, r = a.length;
            r > o;
            o++
          )
            for (s in a[o])
              (n = a[o][s]),
                a[o].hasOwnProperty(s) &&
                  void 0 !== n &&
                  (t[s] = e.isPlainObject(n)
                    ? e.isPlainObject(t[s])
                      ? e.widget.extend({}, t[s], n)
                      : e.widget.extend({}, n)
                    : n);
          return t;
        }),
        (e.widget.bridge = function (t, s) {
          var n = s.prototype.widgetFullName || t;
          e.fn[t] = function (a) {
            var o = "string" == typeof a,
              r = i.call(arguments, 1),
              h = this;
            return (
              (a =
                !o && r.length
                  ? e.widget.extend.apply(null, [a].concat(r))
                  : a),
              o
                ? this.each(function () {
                    var i,
                      s = e.data(this, n);
                    return "instance" === a
                      ? ((h = s), !1)
                      : s
                      ? e.isFunction(s[a]) && "_" !== a.charAt(0)
                        ? ((i = s[a].apply(s, r)),
                          i !== s && void 0 !== i
                            ? ((h = i && i.jquery ? h.pushStack(i.get()) : i),
                              !1)
                            : void 0)
                        : e.error(
                            "no such method '" +
                              a +
                              "' for " +
                              t +
                              " widget instance"
                          )
                      : e.error(
                          "cannot call methods on " +
                            t +
                            " prior to initialization; " +
                            "attempted to call method '" +
                            a +
                            "'"
                        );
                  })
                : this.each(function () {
                    var t = e.data(this, n);
                    t
                      ? (t.option(a || {}), t._init && t._init())
                      : e.data(this, n, new s(a, this));
                  }),
              h
            );
          };
        }),
        (e.Widget = function () {}),
        (e.Widget._childConstructors = []),
        (e.Widget.prototype = {
          widgetName: "widget",
          widgetEventPrefix: "",
          defaultElement: "<div>",
          options: { disabled: !1, create: null },
          _createWidget: function (i, s) {
            (s = e(s || this.defaultElement || this)[0]),
              (this.element = e(s)),
              (this.uuid = t++),
              (this.eventNamespace = "." + this.widgetName + this.uuid),
              (this.bindings = e()),
              (this.hoverable = e()),
              (this.focusable = e()),
              s !== this &&
                (e.data(s, this.widgetFullName, this),
                this._on(!0, this.element, {
                  remove: function (e) {
                    e.target === s && this.destroy();
                  },
                }),
                (this.document = e(
                  s.style ? s.ownerDocument : s.document || s
                )),
                (this.window = e(
                  this.document[0].defaultView ||
                    this.document[0].parentWindow
                ))),
              (this.options = e.widget.extend(
                {},
                this.options,
                this._getCreateOptions(),
                i
              )),
              this._create(),
              this._trigger("create", null, this._getCreateEventData()),
              this._init();
          },
          _getCreateOptions: e.noop,
          _getCreateEventData: e.noop,
          _create: e.noop,
          _init: e.noop,
          destroy: function () {
            this._destroy(),
              this.element
                .unbind(this.eventNamespace)
                .removeData(this.widgetFullName)
                .removeData(e.camelCase(this.widgetFullName)),
              this.widget()
                .unbind(this.eventNamespace)
                .removeAttr("aria-disabled")
                .removeClass(
                  this.widgetFullName + "-disabled " + "ui-state-disabled"
                ),
              this.bindings.unbind(this.eventNamespace),
              this.hoverable.removeClass("ui-state-hover"),
              this.focusable.removeClass("ui-state-focus");
          },
          _destroy: e.noop,
          widget: function () {
            return this.element;
          },
          option: function (t, i) {
            var s,
              n,
              a,
              o = t;
            if (0 === arguments.length)
              return e.widget.extend({}, this.options);
            if ("string" == typeof t)
              if (((o = {}), (s = t.split(".")), (t = s.shift()), s.length)) {
                for (
                  n = o[t] = e.widget.extend({}, this.options[t]), a = 0;
                  s.length - 1 > a;
                  a++
                )
                  (n[s[a]] = n[s[a]] || {}), (n = n[s[a]]);
                if (((t = s.pop()), 1 === arguments.length))
                  return void 0 === n[t] ? null : n[t];
                n[t] = i;
              } else {
                if (1 === arguments.length)
                  return void 0 === this.options[t] ? null : this.options[t];
                o[t] = i;
              }
            return this._setOptions(o), this;
          },
          _setOptions: function (e) {
            var t;
            for (t in e) this._setOption(t, e[t]);
            return this;
          },
          _setOption: function (e, t) {
            return (
              (this.options[e] = t),
              "disabled" === e &&
                (this.widget().toggleClass(
                  this.widgetFullName + "-disabled",
                  !!t
                ),
                t &&
                  (this.hoverable.removeClass("ui-state-hover"),
                  this.focusable.removeClass("ui-state-focus"))),
              this
            );
          },
          enable: function () {
            return this._setOptions({ disabled: !1 });
          },
          disable: function () {
            return this._setOptions({ disabled: !0 });
          },
          _on: function (t, i, s) {
            var n,
              a = this;
            "boolean" != typeof t && ((s = i), (i = t), (t = !1)),
              s
                ? ((i = n = e(i)), (this.bindings = this.bindings.add(i)))
                : ((s = i), (i = this.element), (n = this.widget())),
              e.each(s, function (s, o) {
                function r() {
                  return t ||
                    (a.options.disabled !== !0 &&
                      !e(this).hasClass("ui-state-disabled"))
                    ? ("string" == typeof o ? a[o] : o).apply(a, arguments)
                    : void 0;
                }
                "string" != typeof o &&
                  (r.guid = o.guid = o.guid || r.guid || e.guid++);
                var h = s.match(/^([\w:-]*)\s*(.*)$/),
                  l = h[1] + a.eventNamespace,
                  u = h[2];
                u ? n.delegate(u, l, r) : i.bind(l, r);
              });
          },
          _off: function (t, i) {
            (i =
              (i || "").split(" ").join(this.eventNamespace + " ") +
              this.eventNamespace),
              t.unbind(i).undelegate(i),
              (this.bindings = e(this.bindings.not(t).get())),
              (this.focusable = e(this.focusable.not(t).get())),
              (this.hoverable = e(this.hoverable.not(t).get()));
          },
          _delay: function (e, t) {
            function i() {
              return ("string" == typeof e ? s[e] : e).apply(s, arguments);
            }
            var s = this;
            return setTimeout(i, t || 0);
          },
          _hoverable: function (t) {
            (this.hoverable = this.hoverable.add(t)),
              this._on(t, {
                mouseenter: function (t) {
                  e(t.currentTarget).addClass("ui-state-hover");
                },
                mouseleave: function (t) {
                  e(t.currentTarget).removeClass("ui-state-hover");
                },
              });
          },
          _focusable: function (t) {
            (this.focusable = this.focusable.add(t)),
              this._on(t, {
                focusin: function (t) {
                  e(t.currentTarget).addClass("ui-state-focus");
                },
                focusout: function (t) {
                  e(t.currentTarget).removeClass("ui-state-focus");
                },
              });
          },
          _trigger: function (t, i, s) {
            var n,
              a,
              o = this.options[t];
            if (
              ((s = s || {}),
              (i = e.Event(i)),
              (i.type = (
                t === this.widgetEventPrefix ? t : this.widgetEventPrefix + t
              ).toLowerCase()),
              (i.target = this.element[0]),
              (a = i.originalEvent))
            )
              for (n in a) n in i || (i[n] = a[n]);
            return (
              this.element.trigger(i, s),
              !(
                (e.isFunction(o) &&
                  o.apply(this.element[0], [i].concat(s)) === !1) ||
                i.isDefaultPrevented()
              )
            );
          },
        }),
        e.each({ show: "fadeIn", hide: "fadeOut" }, function (t, i) {
          e.Widget.prototype["_" + t] = function (s, n, a) {
            "string" == typeof n && (n = { effect: n });
            var o,
              r = n
                ? n === !0 || "number" == typeof n
                  ? i
                  : n.effect || i
                : t;
            (n = n || {}),
              "number" == typeof n && (n = { duration: n }),
              (o = !e.isEmptyObject(n)),
              (n.complete = a),
              n.delay && s.delay(n.delay),
              o && e.effects && e.effects.effect[r]
                ? s[t](n)
                : r !== t && s[r]
                ? s[r](n.duration, n.easing, a)
                : s.queue(function (i) {
                    e(this)[t](), a && a.call(s[0]), i();
                  });
          };
        }),
        e.widget;
    });

    // --- Dynamic Block Puzzle Plugin ---
    (function ($) {
      "use strict";

      // --- Default Themes (can be expanded) ---
      const DynamicBlockThemes = {
        default: {
          background: "#ffffff", // Outer grid background
          gridLineColor: "#cfcfcf", // Thin grid lines
          innerSquareBorderColor: "rgba(0, 0, 0, 0.7)", // Bright border for target
          pieceColors: {
            typeA: "#E53E3E", // Red → var(--uchu-red)
            typeB: "#3182CE", // Blue → var(--uchu-blue)
            typeC: "#37A169", // Green → var(--uchu-green)
            typeD: "#ECC94A", // Yellow → var(--uchu-yellow)
            typeE: "#9F7AEA", // Purple → var(--uchu-purple)
            typeF: "#38B2AC", // Teal → Close to green in Uchū
            typeG: "#ED8936", // Orange → var(--uchu-orange)
            typeH: "#D53F8C",
          },
          pieceStrokeColor: "rgba(255, 255, 255, 10.0)", // Darker stroke for pieces
          pieceStrokeWidth: 1,
          selectedPieceStrokeColor: "rgba(255, 255, 255, 10.0)", // Bright white for selected
          selectedPieceStrokeWidth: 1,
          ghostFillColorValid: "rgba(0, 0, 0, 0.10)", // Semi-transparent light
          ghostFillColorInvalid: "rgba(231, 76, 60, 0.35)", // Semi-transparent red
          ghostStrokeColor: "rgba(0, 0, 0, 0.4)",
        },
      };

      // --- Shape Definitions for Piece Transformation ---
      // Helper to create simple rotated versions. For complex shapes, define all 4 rotations manually.
      // This simplified rotation works by swapping and negating coordinates, assuming rotation around (0,0) of the piece's local blocks.
      function _sR(blocks) {
        // simpleRotate90
        const rotated = [];
        for (let i = 0; i < blocks.length; i += 2) {
          rotated.push(-blocks[i + 1], blocks[i]);
        }
        return rotated;
      }

      const PieceShapeRepository = {
        // --- Basic & Tetris-like ---
        dot: {
          name: "Dot 1x1",
          rotations: [
            [0, 0],
            [0, 0],
            [0, 0],
            [0, 0],
          ],
        }, // Alias for 1x1
        line2: {
          name: "Line I2",
          rotations: (() => {
            const b = [0, 0, 0, -1];
            return [b, _sR(b), b, _sR(b)];
          })(),
        },

        line3: {
          name: "Line I3",
          rotations: (() => {
            const b = [0, 0, 0, -1, 0, -2];
            return [b, _sR(b), b, _sR(b)];
          })(),
        },
        line4: {
          name: "Line I4",
          rotations: (() => {
            const b = [0, 0, 0, -1, 0, -2, 0, -3];
            return [b, _sR(b), b, _sR(b)];
          })(),
        },
        line5: {
          name: "Line I5",
          rotations: (() => {
            const b = [0, 0, 0, -1, 0, -2, 0, -3, 0, -4];
            return [b, _sR(b), b, _sR(b)];
          })(),
        },
        lShape3: {
          name: "L-Shape 3",
          rotations: (() => {
            const b = [0, 0, 0, -1, 1, -1];
            const r1 = _sR(b);
            const r2 = _sR(r1);
            const r3 = _sR(r2);
            return [b, r1, r2, r3];
          })(),
        },
        lShape4: {
          name: "L-Shape L4",
          rotations: (() => {
            const b = [0, 0, 0, -1, 0, -2, 1, -2];
            const r1 = _sR(b);
            const r2 = _sR(r1);
            const r3 = _sR(r2);
            return [b, r1, r2, r3];
          })(),
        },
        jShape3: {
          name: "J-Shape 3",
          rotations: (() => {
            const b = [0, 0, 0, -1, -1, -1];
            const r1 = _sR(b);
            const r2 = _sR(r1);
            const r3 = _sR(r2);
            return [b, r1, r2, r3];
          })(),
        },
        jShape4: {
          name: "J-Shape J4",
          rotations: (() => {
            const b = [0, 0, 0, -1, 0, -2, -1, -2];
            const r1 = _sR(b);
            const r2 = _sR(r1);
            const r3 = _sR(r2);
            return [b, r1, r2, r3];
          })(),
        },
        tShape4: {
          name: "T-Shape T4",
          rotations: (() => {
            const b = [-1, 0, 0, 0, 1, 0, 0, -1];
            const r1 = _sR(b);
            const r2 = _sR(r1);
            const r3 = _sR(r2);
            return [b, r1, r2, r3];
          })(),
        },
        square2x2: {
          name: "Square O4",
          rotations: (() => {
            const b = [0, 0, 1, 0, 0, -1, 1, -1];
            return [b, b, b, b];
          })(),
        },
        sShape4: {
          name: "S-Shape S4",
          rotations: (() => {
            const b = [0, 0, -1, 0, 0, -1, 1, -1];
            const r1 = _sR(b);
            return [b, r1, b, r1];
          })(),
        },
        zShape4: {
          name: "Z-Shape Z4",
          rotations: (() => {
            const b = [0, 0, 1, 0, 0, -1, -1, -1];
            const r1 = _sR(b);
            return [b, r1, b, r1];
          })(),
        },
        diagonal2: {
          name: "Diagonal 2",
          rotations: (() => {
            const b = [0, 0, 1, -1];
            const r1 = _sR(b);
            return [b, r1, b, r1];
          })(),
        },
        corner3: {
          name: "Corner L3",
          rotations: (() => {
            const b = [0, 0, 1, 0, 0, -1];
            const r1 = _sR(b);
            const r2 = _sR(r1);
            const r3 = _sR(r2);
            return [b, r1, r2, r3];
          })(),
        }, // Small L
        stubbyT3: {
          name: "Stubby T3",
          rotations: (() => {
            const b = [-1, 0, 0, 0, 0, -1];
            const r1 = _sR(b);
            const r2 = _sR(r1);
            const r3 = _sR(r2);
            return [b, r1, r2, r3];
          })(),
        },

        // --- More Complex Shapes ---
        plus5: {
          name: "Plus 5",
          rotations: (() => {
            const b = [0, 0, -1, 0, 1, 0, 0, -1, 0, 1];
            return [b, b, b, b];
          })(),
        }, // Symmetrical
        uShape5: {
          name: "U-Shape 5",
          rotations: (() => {
            const b = [-1, 0, 1, 0, -1, -1, 0, -1, 1, -1];
            const r1 = _sR(b);
            const r2 = _sR(r1);
            const r3 = _sR(r2);
            return [b, r1, r2, r3];
          })(),
        },
        wideT5: {
          name: "Wide T5",
          rotations: (() => {
            const b = [-1, 0, 0, 0, 1, 0, 2, 0, 0, -1];
            const r1 = _sR(b);
            const r2 = _sR(r1);
            const r3 = _sR(r2);
            return [b, r1, r2, r3];
          })(),
        },
        longL5: {
          name: "Long L5",
          rotations: (() => {
            const b = [0, 0, 0, -1, 0, -2, 0, -3, 1, -3];
            const r1 = _sR(b);
            const r2 = _sR(r1);
            const r3 = _sR(r2);
            return [b, r1, r2, r3];
          })(),
        },
        stairs4: {
          name: "Stairs 4",
          rotations: (() => {
            const b = [0, 0, 1, 0, 1, -1, 2, -1];
            const r1 = _sR(b);
            const r2 = _sR(r1);
            const r3 = _sR(r2);
            return [b, r1, r2, r3];
          })(),
        }, // More like a skewed Z
        cShape6: {
          name: "C-Shape 6",
          rotations: (() => {
            const b = [-1, 1, 0, 1, 1, 1, -1, 0, -1, -1, 0, -1, 1, -1, 1, 0];
            const r1 = _sR(b);
            const r2 = _sR(r1);
            const r3 = _sR(r2);
            return [b, r1, r2, r3];
          })(),
        }, // 3x3 with middle column removed
        hollowBox8: {
          name: "Hollow Box 3x3",
          rotations: (() => {
            const b = [-1, 1, 0, 1, 1, 1, -1, 0, 1, 0, -1, -1, 0, -1, 1, -1];
            return [b, b, b, b];
          })(),
        },
        bigCross9: {
          name: "Big Cross 9",
          rotations: (() => {
            const b = [
              0, 2, -2, 0, 0, -2, -1, 0, 0, 1, -3, 0, 0, 3, 0, 0, 1, 0, 0, -3,
              3, 0, 2, 0, 0, -1,
            ];
            return [b, b, b, b];
          })(),
        }, // 5x5 cross

        // --- Huge & Complex End Stages ---
        frame12_4x4: {
          name: "Frame 4x4",
          rotations: (() => {
            const b = [
              -1, 1, 0, 1, 1, 1, 2, 1, -1, 0, 2, 0, -1, -1, 2, -1, -1, -2, 0,
              -2, 1, -2, 2, -2,
            ];
            return [b, b, b, b];
          })(),
        }, // Hollow 4x4
        capitalH11: {
          name: "Capital H 11",
          rotations: (() => {
            const b = [
              -1, 2, -1, 1, -1, 0, -1, -1, -1, -2, 0, 0, 1, 2, 1, 1, 1, 0, 1,
              -1, 1, -2,
            ];
            const r1 = _sR(b);
            return [b, r1, b, r1];
          })(),
        },
        gridLock9: {
          name: "Pyramid 10",
          rotations: (() => {
            const b = [
              -1.5,
              0,
              -0.5,
              0,
              0.5,
              0,
              1.5,
              0, // base of 4 blocks
              -1,
              -1,
              0,
              -1,
              1,
              -1, // 2nd level
              -0.5,
              -2,
              0.5,
              -2, // 3rd level
              0,
              -3, // top
            ].map((n) => Math.round(n)); // Round to integer grid coordinates
            return [b, b, b, b]; // Symmetrical, so all rotations identical
          })(),
        },
        propeller9: {
          name: "Propeller 9",
          rotations: (() => {
            const b = [
              0, 0, 0, 1, 0, 2, 0, -1, 0, -2, 1, 1, 2, 2, -1, -1, -2, -2,
            ];
            const r1 = _sR(b);
            const r2 = _sR(r1);
            const r3 = _sR(r2);
            return [b, r1, r2, r3];
          })(),
        },
        chevronArrow7: {
          name: "Chevron Arrow 7",
          rotations: (() => {
            const b = [
              -3, -3, 1, 1, -2, -2, 0, 0, 3, -3, -1, 1, 2, -2, 1, -1, -1, -1,
            ];
            const r1 = _sR(b);
            const r2 = _sR(r1);
            const r3 = _sR(r2);
            return [b, r1, r2, r3];
          })(),
        },
        starFort13: {
          name: "Star Fort 13",
          rotations: (() => {
            const b = [
              0, 0, 1, 0, -1, 0, 0, 1, 0, -1, 2, 1, 2, -1, -2, 1, -2, -1, 1,
              2, -1, 2, 1, -2, -1, -2,
            ];
            return [b, b, b, b];
          })(),
        }, // Complex symmetrical
        doubleStairs8: {
          name: "Double Stairs 8",
          rotations: (() => {
            const b = [-1, 1, 0, 1, 0, 0, 1, 0, 1, -1, 2, -1, 2, -2, 3, -2];
            const r1 = _sR(b);
            const r2 = _sR(r1);
            const r3 = _sR(r2);
            return [b, r1, r2, r3];
          })(),
        },
        branchingCross13: {
          name: "Branching Cross 13",
          rotations: (() => {
            const b = [
              0, 0, 0, 1, 1, 1, 0, -1, -1, -1, 1, 0, 1, -1, -1, 0, -1, 1, 2,
              0, -2, 0, 0, 2, 0, -2,
            ];
            return [b, b, b, b];
          })(),
        },
        Shape_1: {
          name: "Shape 1",
          rotations: (() => {
            const b = [
              1, 3, 0, 0, -1, -1, -1, 0, 0, 1, 1, 1, -1, 1, 0, 2, 1, 2,
            ];
            return [b, _sR(b), b, _sR(b)];
          })(),
        },
        Shape_2: {
          name: "Shape 2",
          rotations: (() => {
            const b = [0, 2, 0, 1, 0, 0, -1, -1, 0, -1, 1, 2];
            return [b, _sR(b), b, _sR(b)];
          })(),
        },
        Shape_3: {
          name: "Shape 3",
          rotations: (() => {
            const b = [
              1, -2, 2, -1, 1, 1, 0, 0, 0, -3, -1, -1, -3, -1, -2, -2, 1, -1,
              3, -1, 0, -2, -1, 0, 0, 1, -1, -3, 2, -2, 1, 0, -2, -1, 1, -3,
              -1, 1, 0, -4, -1, -2, 0, -1,
            ];
            return [b, _sR(b), b, _sR(b)];
          })(),
        },
        Shape_4: {
          name: "Shape 4",
          rotations: (() => {
            const b = [
              1, -1, 4, 0, 3, -1, -4, 0, -3, 1, -1, 3, 0, 4, -1, 0, 2, 2, 0,
              1, 3, 1, -1, -3, 1, 1, -2, 2, 1, 3, 2, -2, 1, 0, -1, -1, 1, -3,
              -3, -1, -1, 1, -2, -2, 0, -4, 0, -1,
            ];
            return [b, _sR(b), b, _sR(b)];
          })(),
        },
        Shape_5: {
          name: "Shape 5",
          rotations: (() => {
            const b = [1, -1, 0, 0, -1, -1, 1, 1, -1, 1];
            return [b, _sR(b), b, _sR(b)];
          })(),
        },
        Shape_6: {
          name: "Shape 6",
          rotations: (() => {
            const b = [
              -2, -3, -3, -1, -2, 0, 2, -2, 3, -1, 1, -1, 0, 0, -1, -2, -1, 1,
              -3, -2, -2, -1, 2, 0, 1, -2, 2, -3, 1, 1, 3, -2, -1, -3, 0, 2,
              -1, 0, 0, -1, -2, -2, 1, -3, 1, 0, 2, -1, -1, -1, 0, -2, 0, 1,
            ];
            return [b, _sR(b), b, _sR(b)];
          })(),
        },
        Shape_7: {
          name: "Shape 7",
          rotations: (() => {
            const b = [
              2, -2, 1, 2, 2, 1, 1, -1, 3, -4, 0, 0, -1, 4, 0, 3, 2, 0, 1, -2,
              2, -3, 1, 1, 0, 2, -1, 0, 0, -1, -1, 3, -2, 4, 1, 0, 3, -3, 4,
              -4, 3, 0,
            ];
            return [b, _sR(b), b, _sR(b)];
          })(),
        },

        Shape_8: {
          name: "Shape 8",
          rotations: (() => {
            const b = [1, -1, 0, 0, 1, 0, -1, 1, 2, -1, -2, 2, -1, 2, 0, 1];
            return [b, _sR(b), b, _sR(b)];
          })(),
        },
        Shape_9: {
          name: "Shape 9",
          rotations: (() => {
            const b = [0, 0, 1, 0, -1, 0, 1, -1, -1, -1];
            return [b, _sR(b), b, _sR(b)];
          })(),
        },
        Shape_10: {
          name: "Shape 10",
          rotations: (() => {
            const b = [0, 0, 1, 0, -1, 1, -1, 0, 1, -1];
            return [b, _sR(b), b, _sR(b)];
          })(),
        },
      };

      const PieceTypeProgressions = {
        typeA: ["dot", "Shape_9", "Shape_5", "Shape_1", "bigCross9"], // Red
        typeB: ["dot", "sShape4", "jShape4", "capitalH11", "Shape_3"], // Blue
        typeC: ["dot", "tShape4", "uShape5", "frame12_4x4", "Shape_4"], // Green
        typeD: ["dot", "diagonal2", "stairs4", "gridLock9", "Shape_6"], // Yellow
        typeE: ["dot", "line4", "plus5", "propeller9", "Shape_7"], // Purple
        typeF: ["dot", "lShape3", "wideT5", "Shape_8", "chevronArrow7"], // Dark Gray
        typeG: ["dot", "jShape3", "sShape4", "hollowBox8", "starFort13"], // Purple (alt)
        typeH: [
          "dot",
          "Shape_10",
          "longL5",
          "doubleStairs8",
          "branchingCross13",
        ],
      };

      $.widget("custom.dynamicBlockPuzzle", {
        options: {
          outerGridWidth: 30,
          outerGridHeight: 25,
          blockSize: 20, // pixels
          initialInnerSquareSize: 8,
          minInnerSquareSize: 3,
          maxInnerSquareSize: 11,
          numPieces: 8,
          theme: "default",
          onPieceSelect: function (piece) {},
          onPieceTransform: function (piece) {},
          onInnerSquareResize: function (newSize) {},
        },

        _canvas: null,
        _ctx: null,
        _theme: {},
        _allPieces: [],
        _selectedPiece: null,
        _draggingPiece: null,
        _isDragging: false,
        _dragStartX: 0,
        _dragStartY: 0,
        _pieceDragOffsetBlocksX: 0,
        _pieceDragOffsetBlocksY: 0, // Offset from piece's reference block to clicked block
        _innerSquare: { x: 0, y: 0, size: 0 },
        _pieceIdCounter: 0,

        _create: function () {
          this.element.addClass("dynamic-puzzle-holder");
          this.theme(this.options.theme); // Load theme colors

          this._canvas = $("<canvas></canvas>").appendTo(this.element);
          this._ctx = this._canvas[0].getContext("2d");
          this._updateCanvasSize();

          this._initInnerSquare();
          this._generateInitialPieces(); // Creates Piece instances
          this._bindEvents();
          this._updateSelectedPieceUI();
          this._render();
        },

        _updateCanvasSize: function () {
          const w = this.options.outerGridWidth * this.options.blockSize;
          const h = this.options.outerGridHeight * this.options.blockSize;

          const dpr = window.devicePixelRatio || 1;

          // Set canvas size in physical pixels
          this._canvas[0].width = w * dpr;
          this._canvas[0].height = h * dpr;

          // Set canvas size in CSS pixels
          this._canvas.css({ width: w + "px", height: h + "px" });

          // Scale the context to match device pixel ratio
          this._ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        },

        _initInnerSquare: function () {
          this._innerSquare.size = this.options.initialInnerSquareSize;
          this._innerSquare.x = Math.floor(
            (this.options.outerGridWidth - this._innerSquare.size) / 2
          );
          this._innerSquare.y = Math.floor(
            (this.options.outerGridHeight - this._innerSquare.size) / 2
          );
          $("#inner-square-size-display").text(this._innerSquare.size);
          this._updateBudgetValue();
        },

        // --- Piece Class Definition (Constructor within the plugin) ---
        Piece: function (pluginInstance, id, typeKey, x, y) {
          this.plugin = pluginInstance; // Reference to the plugin
          this.id = id;
          this.typeKey = typeKey; // e.g., "typeA"
          this.x = x; // grid units for piece's reference point
          this.y = y;

          this.progressionKeys = PieceTypeProgressions[typeKey];
          if (!this.progressionKeys) {
            console.error("Undefined piece type progression:", typeKey);
            this.progressionKeys = PieceTypeProgressions.typeA; // Fallback
          }
          this.currentShapeKeyIndex = 0; // Index in this.progressionKeys

          this.orientation = 0; // 0, 1, 2, 3
          this.color = this.plugin._theme.pieceColors[typeKey] || "#CCCCCC"; // Get color from theme
        },
        _updateBudgetValue: function () {
           const size  = this._innerSquare.size;
  const value = size * 5 + 15;   // 3→30, 5→40, 7→50, 9→60, 11→70
  $("#budget-val").text(value);
        },
        _setupPiecePrototype: function () {
          var self = this; // 'self' is the plugin instance for use in prototype methods

          this.Piece.prototype.getCurrentShapeDefinition = function () {
            const shapeKey = this.progressionKeys[this.currentShapeKeyIndex];
            return PieceShapeRepository[shapeKey];
          };

          this.Piece.prototype.getBlocks = function (orientationOverride) {
            const shapeDef = this.getCurrentShapeDefinition();
            if (!shapeDef) return []; // Should not happen if progressions are correct
            const effectiveOrientation =
              orientationOverride !== undefined
                ? orientationOverride
                : this.orientation;
            return shapeDef.rotations[
              effectiveOrientation % shapeDef.rotations.length
            ];
          };

          this.Piece.prototype.getBounds = function (orientationOverride) {
            const blocks = this.getBlocks(orientationOverride);
            if (!blocks || blocks.length === 0)
              return {
                left: 0,
                right: 0,
                top: 0,
                bottom: 0,
                width: 0,
                height: 0,
              };
            let minX = Infinity,
              maxX = -Infinity,
              minY = Infinity,
              maxY = -Infinity;
            for (let i = 0; i < blocks.length; i += 2) {
              if (blocks[i] < minX) minX = blocks[i];
              if (blocks[i] > maxX) maxX = blocks[i];
              if (blocks[i + 1] < minY) minY = blocks[i + 1];
              if (blocks[i + 1] > maxY) maxY = blocks[i + 1];
            }
            return {
              left: minX,
              right: maxX,
              top: minY,
              bottom: maxY,
              width: maxX - minX,
              height: maxY - minY,
            };
          };

          this.Piece.prototype.rotate = function (direction) {
            const oldOrientation = this.orientation;
            const shapeDef = this.getCurrentShapeDefinition();
            const numOrientations = shapeDef.rotations.length;
            this.orientation =
              (this.orientation +
                (direction === "left" ? -1 : 1) +
                numOrientations) %
              numOrientations;

            if (
              self._isOutOfBounds(this) ||
              self._checkPieceToPieceCollision(this, this.x, this.y, this)
            ) {
              this.orientation = oldOrientation;
              return false;
            }
            return true;
          };

          this.Piece.prototype.transformShape = function (direction) {
            const oldShapeKeyIndex = this.currentShapeKeyIndex;
            const numShapesInProgression = this.progressionKeys.length;
            this.currentShapeKeyIndex =
              (this.currentShapeKeyIndex +
                (direction === "prev" ? -1 : 1) +
                numShapesInProgression) %
              numShapesInProgression;
            this.orientation = 0; // Reset orientation

            if (
              self._isOutOfBounds(this) ||
              self._checkPieceToPieceCollision(this, this.x, this.y, this)
            ) {
              this.currentShapeKeyIndex = oldShapeKeyIndex; // Revert
              this.orientation = 0; // Also revert orientation reset if transform fails
              return false;
            }
            self.options.onPieceTransform.call(self.element, this);
            return true;
          };

          this.Piece.prototype.isBlockAt = function (checkGridX, checkGridY) {
            const blocks = this.getBlocks();
            for (let i = 0; i < blocks.length; i += 2) {
              if (
                this.x + blocks[i] === checkGridX &&
                this.y + blocks[i + 1] === checkGridY
              ) {
                return true;
              }
            }
            return false;
          };
        },
        _shuffleArray: function (array) {
          const a = array.slice();
          for (let i = a.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [a[i], a[j]] = [a[j], a[i]];
          }
          return a;
        },
        _generateInitialPieces: function () {
          this._setupPiecePrototype(); // Ensure Piece methods are available
          this._allPieces = [];
          this._pieceIdCounter = 0;
          const pieceTypeKeys = this._shuffleArray(
            Object.keys(PieceTypeProgressions)
          ).slice(0, this.options.numPieces);

          for (let i = 0; i < pieceTypeKeys.length; i++) {
            const typeKey = pieceTypeKeys[i];
            let pX, pY, newPiece;
            let attempts = 0;
            const maxAttempts = 100;

            do {
              const shapeKey = PieceTypeProgressions[typeKey][1]; // Stage 2
              const tempPiece = new this.Piece(this, -1, typeKey, 0, 0);
              tempPiece.currentShapeKeyIndex = 1;
              const bounds = tempPiece.getBounds();

              // Calculate safe placement bounds based on piece dimensions
              const minX = -bounds.left + 1;
              const maxX = this.options.outerGridWidth - bounds.right - 2;
              const minY = -bounds.top + 1;
              const maxY = this.options.outerGridHeight - bounds.bottom - 2;

              // If piece is too large to fit even once, skip
              if (minX > maxX || minY > maxY) {
                console.warn(`Piece too large to place: ${typeKey}`);
                break;
              }

              pX = this._randInt(minX, maxX);
              pY = this._randInt(minY, maxY);

              newPiece = new this.Piece(
                this,
                this._pieceIdCounter++,
                typeKey,
                pX,
                pY
              );
              newPiece.currentShapeKeyIndex = 1; // Start at stage 2

              attempts++;
              if (attempts > maxAttempts) {
                newPiece = null;
                break;
              }
            } while (
              this._isOutOfBounds(newPiece) ||
              this._checkPieceToPieceCollision(
                newPiece,
                newPiece.x,
                newPiece.y,
                null
              )
            );

            if (newPiece) {
              this._allPieces.push(newPiece);
            } else {
              console.warn(
                "Could not place a piece after " + maxAttempts + " attempts."
              );
            }
          }
        },

        _bindEvents: function () {
          const self = this;
          this._canvas.on("mousedown.dynPuzzle", function (e) {
            self._handleMouseDown(e);
          });

          $(document).on("keydown.dynPuzzle", function (e) {
            if (e.key.toLowerCase() === "r") {
              e.preventDefault(); // Prevent default 'r' behavior like page reload
              const targetPiece = self._draggingPiece || self._selectedPiece;
              if (targetPiece && targetPiece.rotate("right")) {
                self._render();
              }
            }
          });

          $("#inner-square-increase").on("click.dynPuzzle", function () {
            self._resizeInnerSquare(1);
          });
          $("#inner-square-decrease").on("click.dynPuzzle", function () {
            self._resizeInnerSquare(-1);
          });
          $("#piece-transform-next").on("click.dynPuzzle", function () {
            self._transformSelectedPiece("next");
          });
          $("#piece-transform-prev").on("click.dynPuzzle", function () {
            self._transformSelectedPiece("prev");
          });
        },

        _isPieceInsideInnerSquare: function (piece) {
          const blocks = piece.getBlocks();
          for (let i = 0; i < blocks.length; i += 2) {
            const bx = piece.x + blocks[i];
            const by = piece.y + blocks[i + 1];
            if (
              bx < this._innerSquare.x ||
              bx >= this._innerSquare.x + this._innerSquare.size ||
              by < this._innerSquare.y ||
              by >= this._innerSquare.y + this._innerSquare.size
            ) {
              return false;
            }
          }
          return true;
        },

        _checkAllPiecesInsideInnerSquare: function () {
          for (const piece of this._allPieces) {
            if (!this._isPieceInsideInnerSquare(piece)) return false;
          }
          return true;
        },

        _handleMouseDown: function (e) {
          const rect = this._canvas[0].getBoundingClientRect();
          const mouseX = e.clientX - rect.left;
          const mouseY = e.clientY - rect.top;
          const clickGridX = Math.floor(mouseX / this.options.blockSize);
          const clickGridY = Math.floor(mouseY / this.options.blockSize);

          let clickedPiece = null;
          for (let i = this._allPieces.length - 1; i >= 0; i--) {
            // Iterate backwards for Z-order
            if (this._allPieces[i].isBlockAt(clickGridX, clickGridY)) {
              clickedPiece = this._allPieces[i];
              break;
            }
          }

          if (clickedPiece) {
            this._selectedPiece = clickedPiece;
            this._draggingPiece = clickedPiece;
            this._isDragging = true;

            // Bring to front for rendering by moving to end of array
            this._allPieces.splice(this._allPieces.indexOf(clickedPiece), 1);
            this._allPieces.push(clickedPiece);

            // Offset of the specific block clicked within the piece's local coordinate system
            this._pieceDragOffsetBlocksX = clickGridX - clickedPiece.x;
            this._pieceDragOffsetBlocksY = clickGridY - clickedPiece.y;

            $(document).on(
              "mousemove.dynPuzzle",
              this._handleMouseMove.bind(this)
            );
            $(document).on(
              "mouseup.dynPuzzle",
              this._handleMouseUp.bind(this)
            );
            this.options.onPieceSelect.call(
              this.element,
              this._selectedPiece
            );
          } else {
            this._selectedPiece = null;
          }
          this._updateSelectedPieceUI();
          this._render();
        },

        _handleMouseMove: function (e) {
          if (!this._isDragging || !this._draggingPiece) return;

          const rect = this._canvas[0].getBoundingClientRect();
          const mouseX = e.clientX - rect.left;
          const mouseY = e.clientY - rect.top;

          // Target for the piece's reference point (0,0)
          const targetPieceRefX =
            Math.floor(mouseX / this.options.blockSize) -
            this._pieceDragOffsetBlocksX;
          const targetPieceRefY =
            Math.floor(mouseY / this.options.blockSize) -
            this._pieceDragOffsetBlocksY;

          this._draggingPiece._ghostX = targetPieceRefX;
          this._draggingPiece._ghostY = targetPieceRefY;
          this._render();
        },

        _handleMouseUp: function (e) {
          $(document).off("mousemove.dynPuzzle mouseup.dynPuzzle");
          if (!this._isDragging || !this._draggingPiece) return;

          const ghost = this._draggingPiece;
          // only do anything if we actually set _ghostX/Y on mousemove
          if (ghost._ghostX !== undefined && ghost._ghostY !== undefined) {
            const targetX = ghost._ghostX;
            const targetY = ghost._ghostY;

            if (
              !this._isOutOfBounds(ghost, targetX, targetY) &&
              !this._checkPieceToPieceCollision(
                ghost,
                targetX,
                targetY,
                ghost
              )
            ) {
              ghost.x = targetX;
              ghost.y = targetY;
            }
          }

          // clean up
          delete ghost._ghostX;
          delete ghost._ghostY;
          this._isDragging = false;
          this._draggingPiece = null;
          this._render();
        },
        _resizeInnerSquare: function (delta) {
          const newSize = this._innerSquare.size + delta * 2;
          if (
            newSize >= this.options.minInnerSquareSize &&
            newSize <= this.options.maxInnerSquareSize
          ) {
            this._innerSquare.size = newSize;
            this._innerSquare.x = Math.floor(
              (this.options.outerGridWidth - this._innerSquare.size) / 2
            );
            this._innerSquare.y = Math.floor(
              (this.options.outerGridHeight - this._innerSquare.size) / 2
            );
            $("#inner-square-size-display").text(this._innerSquare.size);
            this.options.onInnerSquareResize.call(this.element, newSize);
            this._updateBudgetValue();
            this._render();
          }
        },

        _transformSelectedPiece: function (direction) {
          if (
            this._selectedPiece &&
            this._selectedPiece.transformShape(direction)
          ) {
            this._updateSelectedPieceUI();
            this._render();
          }
        },

        _updateSelectedPieceUI: function () {
          if (this._selectedPiece) {
            const idx = this._selectedPiece.currentShapeKeyIndex;
            let symbol = "¢";
            let weight = 600;

            if (idx === 1) {
              symbol = "$";
              weight = 400;
            } else if (idx === 2) {
              symbol = "$";
              weight = 600;
            } else if (idx === 3) {
              symbol = "$";
              weight = 900;
            } else if (idx >= 4) {
              symbol = "$$";
              weight = 1000;
            }

            $("#piece-value-symbol").text(symbol).css("font-weight", weight);
            // map typeKey to a human-friendly name and description
            const typeNames = {
              typeA: "The Ottawa Mission",
              typeB: "Shepherds of Good Hope",
              typeC: "Cornerstone Housing for Women",
              typeD: "Youth Services Bureau",
              typeE: "Montfort Renaissance",
              typeF: "CCOC Housing"
            };
            const typeDescriptions = {
              typeA: "Provides emergency shelter and support services in Ottawa. In 2024, the City of Ottawa provided $5,504,633 in funding.",
              typeB: "A harm‑reduction and housing‑first agency offering specialized programs for chronically homeless individuals; City funding $8,980,769 in 2024.",
              typeC: "A women‑only emergency shelter and long‑term housing provider with a trauma‑informed approach; expanded to 150 beds in 2024; City funding $340,765.",
              typeD: "Operates two youth‑dedicated emergency shelters and longer‑term housing, focusing on family reconnection and education/employment; City funding $5,098,345 in 2024.",
              typeE: "French‑language service focusing on addictions, mental health, housing, and seniors; City funding $1,417,102 in 2024.",
              typeF: "Affordable housing provider using a self‑sustaining mortgage model, gradually reducing homelessness over time."
            };
            const key = this._selectedPiece.typeKey;
            $("#selected-piece-id").text(typeNames[key] || key);
            $("#selected-piece-description")
              .text(typeDescriptions[key] || "")
              .toggle(Boolean(typeDescriptions[key]));
            $("#selected-piece-shape-name").text(
              this._selectedPiece.getCurrentShapeDefinition().name
            );
            $("#selected-piece-info").show();
            $("#no-piece-selected-msg").hide();
          } else {
            $("#selected-piece-info").hide();
            $("#selected-piece-description").hide();
            $("#no-piece-selected-msg").show();
          }
        },

        _isOutOfBounds: function (piece, newX, newY) {
          const x = newX !== undefined ? newX : piece.x;
          const y = newY !== undefined ? newY : piece.y;
          const blocks = piece.getBlocks();
          if (!blocks || blocks.length === 0) return false; // No blocks, can't be out of bounds

          for (let i = 0; i < blocks.length; i += 2) {
            const bx = x + blocks[i];
            const by = y + blocks[i + 1];
            if (
              bx < 0 ||
              bx >= this.options.outerGridWidth ||
              by < 0 ||
              by >= this.options.outerGridHeight
            ) {
              return true;
            }
          }
          return false;
        },

        _checkPieceToPieceCollision: function (
          pieceToCheck,
          newX,
          newY,
          ignorePieceInstance
        ) {
          const blocksToCheck = pieceToCheck.getBlocks();
          if (!blocksToCheck || blocksToCheck.length === 0) return false;

          for (let i = 0; i < blocksToCheck.length; i += 2) {
            const checkGridX = newX + blocksToCheck[i];
            const checkGridY = newY + blocksToCheck[i + 1];

            for (const otherPiece of this._allPieces) {
              if (otherPiece === ignorePieceInstance) continue;
              if (otherPiece.isBlockAt(checkGridX, checkGridY)) {
                return true;
              }
            }
          }
          return false;
        },

        _render: function () {
          this._ctx.clearRect(
            0,
            0,
            this._canvas.width(),
            this._canvas.height()
          );
          this._drawOuterGrid();

          for (const piece of this._allPieces) {
            if (piece !== this._draggingPiece) {
              // Don't draw the actual piece if it's being dragged (ghost will be drawn)
              this._drawPiece(piece, piece === this._selectedPiece);
            }
          }

          if (
            this._isDragging &&
            this._draggingPiece &&
            this._draggingPiece._ghostX !== undefined
          ) {
            // Check if ghost position is set
            this._drawPieceGhost(
              this._draggingPiece,
              this._draggingPiece._ghostX,
              this._draggingPiece._ghostY
            );
          }
          this._drawInnerSquare();
          const allInside = this._checkAllPiecesInsideInnerSquare();
          $("#submit-button").prop("disabled", !allInside);
        },

        _drawOuterGrid: function () {
          this._ctx.fillStyle = this._theme.background;
          this._ctx.fillRect(
            0,
            0,
            this._canvas.width(),
            this._canvas.height()
          );
          this._ctx.strokeStyle = this._theme.gridLineColor;
          this._ctx.lineWidth = 0.5; // Thinner lines
          for (let x = 0; x <= this.options.outerGridWidth; x++) {
            this._ctx.beginPath();
            this._ctx.moveTo(x * this.options.blockSize + 0.5, 0); // +0.5 for crisp lines
            this._ctx.lineTo(
              x * this.options.blockSize + 0.5,
              this.options.outerGridHeight * this.options.blockSize
            );
            this._ctx.stroke();
          }
          for (let y = 0; y <= this.options.outerGridHeight; y++) {
            this._ctx.beginPath();
            this._ctx.moveTo(0, y * this.options.blockSize + 0.5);
            this._ctx.lineTo(
              this.options.outerGridWidth * this.options.blockSize,
              y * this.options.blockSize + 0.5
            );
            this._ctx.stroke();
          }
        },

        _drawInnerSquare: function () {
          this._ctx.strokeStyle = this._theme.innerSquareBorderColor;
          this._ctx.lineWidth = 2;
          this._ctx.strokeRect(
            this._innerSquare.x * this.options.blockSize,
            this._innerSquare.y * this.options.blockSize,
            this._innerSquare.size * this.options.blockSize,
            this._innerSquare.size * this.options.blockSize
          );
        },

        _drawPiece: function (piece, isSelected) {
          const blocks = piece.getBlocks();
          if (!blocks || blocks.length === 0) return;
          this._ctx.fillStyle = piece.color;

          this._ctx.strokeStyle = isSelected
            ? this._theme.selectedPieceStrokeColor
            : this._theme.pieceStrokeColor;
          this._ctx.lineWidth = isSelected
            ? this._theme.selectedPieceStrokeWidth
            : this._theme.pieceStrokeWidth;

          for (let i = 0; i < blocks.length; i += 2) {
            // Adjust for crisp lines if lineWidth is odd
            const strokeOffset = this._ctx.lineWidth % 2 === 1 ? 0.5 : 0;
            const x =
              (piece.x + blocks[i]) * this.options.blockSize + strokeOffset;
            const y =
              (piece.y + blocks[i + 1]) * this.options.blockSize +
              strokeOffset;
            const s = this.options.blockSize;

            this._ctx.fillRect(x, y, s, s);
            this._ctx.strokeRect(x, y, s, s);
          }
        },

        _drawPieceGhost: function (piece, ghostX, ghostY) {
          const blocks = piece.getBlocks();
          if (!blocks || blocks.length === 0) return;
          const isValidMove =
            !this._isOutOfBounds(piece, ghostX, ghostY) &&
            !this._checkPieceToPieceCollision(piece, ghostX, ghostY, piece);

          this._ctx.fillStyle = isValidMove
            ? this._theme.ghostFillColorValid
            : this._theme.ghostFillColorInvalid;
          this._ctx.strokeStyle = this._theme.ghostStrokeColor;
          this._ctx.lineWidth = 1;

          for (let i = 0; i < blocks.length; i += 2) {
            const strokeOffset = 0.5; // For 1px line width
            const x =
              (ghostX + blocks[i]) * this.options.blockSize + strokeOffset;
            const y =
              (ghostY + blocks[i + 1]) * this.options.blockSize +
              strokeOffset;
            const s = this.options.blockSize;

            this._ctx.fillRect(x, y, s, s);
            this._ctx.strokeRect(x, y, s, s);
          }
        },

        theme: function (newThemeNameOrObject) {
          if (typeof newThemeNameOrObject === "undefined") {
            return this.options.theme; // Return current theme name or null if custom object
          }
          let themeObj;
          if (typeof newThemeNameOrObject === "string") {
            this.options.theme = newThemeNameOrObject;
            themeObj =
              DynamicBlockThemes[newThemeNameOrObject] ||
              DynamicBlockThemes.default;
          } else {
            this.options.theme = null; // Custom theme object
            themeObj = newThemeNameOrObject;
          }
          this._theme = $.extend(
            true,
            {},
            DynamicBlockThemes.default,
            themeObj
          ); // Deep merge with default

          if (this._allPieces.length > 0) {
            this._allPieces.forEach((p) => {
              p.color = this._theme.pieceColors[p.typeKey] || "#BDC3C7"; // Fallback color
            });
          }
          if (this._ctx) this._render(); // Re-render if canvas exists
        },

        _randInt: function (a, b) {
          return a + Math.floor(Math.random() * (1 + b - a));
        },

        _destroy: function () {
          this._canvas.off(".dynPuzzle");
          $(document).off(".dynPuzzle");
          $(
            "#inner-square-increase, #inner-square-decrease, #piece-transform-next, #piece-transform-prev"
          ).off(".dynPuzzle");
          this.element.empty().removeClass("dynamic-puzzle-holder");
        },
      });
    })(jQuery);
    // --- Initialize ---
    $(document).ready(function () {
      $("#game-area").dynamicBlockPuzzle({
        outerGridWidth: 15,
        outerGridHeight: 15,
        blockSize: 34,
        initialInnerSquareSize: 7,
        numPieces: 8,
        theme: "candy",
        onPieceSelect: function (p) {
          console.log("Selected Piece ID:", p ? p.id : "None");
        },
      });
    });


$(document).on("click", "#submit-button", function () {
    console.log("clicked");

    const puzzle = $("#game-area").dynamicBlockPuzzle("instance");

    // Register Ottawa Mission policy
    PolicyManager.register({
      name: "The Ottawa Mission",
      costUpfront: 0,
  duration: puzzle._allPieces.find(p => p.typeKey === "typeA")?.currentShapeKeyIndex || 1,
      immediate(v) {
        // no immediate effect
      },
      tick(v, Util) {
        // Shift 5% of unsheltered into shelter
        const shifted = Math.round(v.unsheltered * 0.05);
        v.unsheltered -= shifted;
        v.sheltered   += shifted;
        // 1% of total homeless exit via wrap-around care
        const exits = Math.round(v.homelessTotal * 0.01);
        window.Util.exitPeople(exits);
        // Public opinion boost
        v.publicOpinion += 5;
        // Capacity down
        v.systemCapacity -= v.systemCapacity * 0.01;
      },
    });

    // Register Shepherds of Good Hope policy
    PolicyManager.register({
      name: "Shepherds of Good Hope",
      costUpfront: 0,
      costPerTurn: 0,
  duration: puzzle._allPieces.find(p => p.typeKey === "typeB")?.currentShapeKeyIndex || 1,
      immediate(v) {
        // no immediate effect
      },
      tick(v, Util) {
        // Shift 3% of unsheltered into shelter
        const usToSh = Math.round(v.unsheltered * 0.03);
        v.unsheltered   -= usToSh;
        v.sheltered     += usToSh;
        // Shift 3% of institutional into shelter
        const instToSh = Math.round(v.institutional * 0.03);
        v.institutional -= instToSh;
        v.sheltered     += instToSh;
        // 1% exit via wrap-around care
        const exits = Math.round(v.homelessTotal * 0.01);
        window.Util.exitPeople(exits);
        // Public opinion hit
        v.publicOpinion -= 5;
        // Capacity drain
        v.systemCapacity -= v.systemCapacity * 0.005;
      },
    });

    // Register Cornerstone Housing for Women policy
    PolicyManager.register({
      name: "Cornerstone Housing for Women",
      costUpfront: 0,
  duration: puzzle._allPieces.find(p => p.typeKey === "typeC")?.currentShapeKeyIndex || 1,
      immediate(v) {
        // no immediate effect
      },
      tick(v, Util) {
        // 4% of unsheltered exit via wrap-around care
        const exits = Math.round(v.unsheltered * 0.04);
        v.unsheltered -= exits;
        window.Util.exitPeople(exits);
        // Public opinion boost
        v.publicOpinion += 3;
      },
    });

    // Register Youth Services Bureau policy
    PolicyManager.register({
      name: "Youth Services Bureau",
      costUpfront: 0,
  duration: puzzle._allPieces.find(p => p.typeKey === "typeD")?.currentShapeKeyIndex || 1,
      immediate(v) {
        // no immediate effect
      },
      tick(v, Util) {
        // 8% of unsheltered youth exit via wrap-around care
        const exits = Math.round(v.unsheltered * 0.08);
        v.unsheltered -= exits;
        window.Util.exitPeople(exits);
        // Public opinion boost
        v.publicOpinion += 5;
      },
    });

    // Register Montfort Renaissance policy
    PolicyManager.register({
      name: "Montfort Renaissance",
      costUpfront: 1,
  duration: puzzle._allPieces.find(p => p.typeKey === "typeE")?.currentShapeKeyIndex || 1,
      immediate(v) {
        // no immediate effect
      },
      tick(v, Util) {
        // 1% of total homeless exit via wrap-around care
        const exits = Math.round(v.homelessTotal * 0.01);
        window.Util.exitPeople(exits);
        // Public opinion boost
        v.publicOpinion += 5;
      },
    });

    // Register CCOC Housing policy
    PolicyManager.register({
      name: "CCOC Housing",
      costUpfront: 0,
  duration: puzzle._allPieces.find(p => p.typeKey === "typeF")?.currentShapeKeyIndex || 1,
      immediate(v) {
        // no immediate effect
      },
      tick(v, Util) {
        // 0.2% of total homeless exit each tick via housing exits
        const exits = Math.round(v.homelessTotal * 0.002);
        window.Util.exitPeople(exits);
        // Public opinion boost
        v.publicOpinion += 1;
      },
    });

    const allocated = parseInt($("#budget-val").text(), 10);
    PolicyManager.register({
      name: "Budget Allocation",
      costUpfront: allocated,
      duration: 1, 
    });

    Engine.play("ChooseProposal");
});

  <</script>>
  <style>
  /* styles.css - Light Mode */

body {
  font-family: sans-serif;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  margin-top: 20px;

}

.puzzle-layout {
  margin-top: 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
}

.dynamic-puzzle-holder {
}

#game-area canvas {
  display: block;
  background-color: #ffffff; /* Light canvas background */
  border: 1px solid #dcdcdc; /* Subtle border for contrast */
}
.dollar-sign {
  font-family: "Spectral", serif;
  font-size: 30px;
  font-weight: 400;
  color: #0066cc;
}

.submit-btn {
  background-color: #ffffff;
  color: #111827; /* Tailwind slate-900 */
  border: 1px solid #e5e7eb; /* Tailwind gray-200 */
  padding: 0.5rem 0.75rem;
  border-radius: 0.5rem;
  font-size: 0.875rem;
  font-weight: 500;
  line-height: 1.25;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
  cursor: pointer;
  transition: all 0.2s ease-in-out;
  margin: 0.3rem;
  position: relative;
  top: -0.25rem;
}

.submit-btn:disabled {
  opacity: 0.35;
  background-color: #f3f4f6; /* Tailwind gray-100 */
  color: #9ca3af; /* Tailwind gray-400 */
  border-color: #d1d5db; /* Tailwind gray-300 */
  cursor: not-allowed;
  box-shadow: none;
}

.title {
  font-family: "Inter", Helvetica, Arial, sans-serif;
  font-size: 14px;
  font-weight: 400;
  color: #383838;
  text-transform: uppercase;
}

.digits2 {
  font-family: "Spectral", serif;
  font-size: 32px;
  font-weight: 600;
  color: #000000;
}
.controls-panel {
  width: 510px;
  padding: 20px;
  background-color: #ffffff;
  border-radius: 5px;
  border-radius: 15px;
  border-color: rgba(156, 162, 166, 0.32);
  border-width: 1px;
  border-style: solid;
}

.controls-panel h3 {
  margin-top: 0;
  margin-bottom: 12px;
  font-size: 1.1em;
  color: #2980b9; /* Accent color for headings */
  border-bottom: 1px solid #ecf0f1;
  padding-bottom: 8px;
}

.controls-panel p {
  margin-top: 5px;
  font-family: "Inter", Helvetica, Arial, sans-serif;
  margin-bottom: 10px;
  font-size: 0.9em;
  line-height: 1.4;
  color: #2c3e50;
}

.control-group {
  margin-bottom: 18px;
}

.control-group label {
  display: block;
  margin-bottom: 5px;
  font-size: 0.9em;
  color: #555555;
}

.selected-piece-id {
  font-family: "Inter", Helvetica, Arial, sans-serif;
  font-size: 14px;
  font-weight: 400;
  color: #383838;
  text-transform: uppercase;
}
.control-btn,
#inner-square-size-display,
#selected-piece-shape-name {
  background-color: #ffffff;
  color: #4d4d4d;
  border: 1px solid #e5e7eb;
  padding: 0.5rem 0.75rem;
  border-radius: 0.5rem;
  font-size: 0.875rem;
  font-weight: 500;
  line-height: 1.25;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
  cursor: pointer;
  transition: all 0.2s ease-in-out;
  margin: 0.3rem;
  position: relative;
  top: -0.25rem;
}

.control-btn:hover {
  background-color: #f9fafb;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.06);
  transform: scale(1.02);
}

.control-btn:active {
  background-color: #f3f4f6;
  transform: scale(0.96);
}

.control-btn:focus {
  outline: 2px solid #2563eb;
  outline-offset: 2px;
}

#inner-square-size-display,
#selected-piece-shape-name {
  cursor: default;
  background-color: #e8e8e8;
  padding: 8px;
  display: inline-block;
  min-width: 30px;
  text-align: center;
}

#selected-piece-controls-group {
  margin-top: 15px;
}

#no-piece-selected-msg {
  font-style: italic;
  color: #999999;
  font-size: 0.85em;
}
.passage {
  width: 100% !important;
}

  </style>


:: Start {"position":"600,100","size":"100,100"}
<<set $history = []>>
<div class="passageContent"> In 2014, the City of Ottawa launched its first 10-Year Housing and Homelessness Plan with three priorities: <span title="A range of housing options meets demand through construction, purchase, redevelopment, housing subsidies, Affordable housing is in a good state of repair and well-managed."> ensuring everyone has a home</span>, <span title="People receive the right types of services and support to keep their homes and to prevent homelessness. People who become homeless are safe and receive adequate temporary shelter and supports to find housing. There is no chronic homelessness.">people get the support they need </span> and <span title="Ottawa has an integrated housing system, responsive to the housing and support needs of residents. Improved service planning and coordination and sustained funding from all levels of government meet people's needs.">working together / collaboration </span>.

Despite these goals, the nation's capital became the first city in Canada to declare a housing and homelessness emergency in January 2020. More people are sleeping on the streets, in shelters, and in their cars than at any point in the city's history. Now, Ottawa is midway through its 2020–2030 Housing and Homelessness Plan and, as required every five years, is taking a hard look at what's working, what's missing, and what needs to change. From Q2 to Q3, the city is gathering input through consultations with the housing and homelessness sector, people with lived experience, and frontline service providers. Their insights will shape the revised strategy to be presented to the Community Services Committee and City Council.

You've been brought into the city halls at a pivotal moment, right before the next phase of the 10-Year Plan is finalized. Your task is to explore how different decisions, funding priorities, and policy trade-offs change outcomes over time. You can't solve everything at once. But you can change the direction we're heading — starting now.

<<set $turn = 1>>
<<set $year= 1>>
<<set $currentYear= 2024>>
<<set $budget = 215>>

<<set $homelessTotal = 2952>>

<!-- Demographic breakdown of CURRENT homeless population -->
<<set $pop = {
  // Housing status
  unsheltered: 472,      // 16% of 2952
  sheltered: 1269,       // 43%
  transitional: 708,     // 24%
  institutional: 59,     // 2%
  chronic: 1446,         // 49%
  withChildren: 295,     // 10%
  fosterCareHistory: 561, // 19%

  // Identity demographics
  male: Math.round(2952 * 0.56),
  female: Math.round(2952 * 0.36),
  transNB: Math.round(2952 * 0.02),
  age25to49: Math.round(2952 * 0.58),
  youth: Math.round(2952 * 0.13),
  lgbq: Math.round(2952 * 0.11),
  lgbtqYouth: Math.round(2952 * 0.11 * 0.21),
  racialized: Math.round(2952 * 0.56),
  indigenous: 479,           // exact number provided
  veteran: Math.round(2952 * 0.04),
  immigrant: Math.round(2952 * 0.42)
}>>

<!-- INFLOW system -->
<<set $inflowBase = 0>> <!-- Number of new homeless per turn -->

<!-- Percentage distribution of INCOMING new homelessness cases -->
<<set $inflowShare = {
  // Housing status (default to unsheltered for new arrivals)
  unsheltered: 0.16,
  sheltered: 0.43,
  transitional: 0.24,
  institutional: 0.02,
  chronic: 0.49,
  withChildren: 0.10,
  fosterCareHistory: 0.19,

  // Identity demographics
  male: 0.56,
  female: 0.36,
  transNB: 0.02,
  lgbtqYouth: 0.21,
  age25to49: 0.58,
  lgbq: 0.11,
  racialized: 0.56,
  indigenous: 479 / 2952,    // ~16.2%
  veteran: 0.04,
  immigrant: 0.42
}>>


<!-- System + policy levers -->
<<set $publicOpinion = 50>>
<<set $serviceCoordination = 60>>
<<set $systemCapacity = 100>>
<<set $politicalCapital = 3>>

<<script>>
  // Create an initial snapshot representing the state *before* year 1 begins.
  // This helps in comparing the first year's results against something.
  const v = State.variables;
  const initialPopSnapshot = {}; // Deep copy $pop
  for (const key in v.pop) {
      if (Object.prototype.hasOwnProperty.call(v.pop, key)) {
          initialPopSnapshot[key] = v.pop[key];
      }
  }
  const initialSnapshot = {
    year: 0, // Conceptual "Year 0" or pre-game state
    turn: 0, // Conceptual "Turn 0"
    homelessTotal: v.homelessTotal,
    pop: initialPopSnapshot,
    budget: v.budget,
    publicOpinion: v.publicOpinion,
    serviceCoordination: v.serviceCoordination,
    systemCapacity: v.systemCapacity,
    politicalCapital: v.politicalCapital
  };
  v.history.push(initialSnapshot);
<</script>>


* [[Start|ChooseCityPolicy1]]

</div>


:: StoryInterface {"position":"1225,275","size":"100,100"}
<!--  =====  PERSISTENT UI  =====  -->

<div id="spent-ui">
  <div id="passages">
    <div id="passage-start" data-passage="start" class="passage"></div>
  </div>

  <!-- Timeline -->
  <div id="timeline" class="timeline active">
    <span class="day active" id="year_2024">
      <span class="container"><span class="number">2024</span></span>
    </span>
    <span class="day spacer"></span><span class="day spacer"></span>

    <span class="day" id="year_2025">
      <span class="container"><span class="number">2025</span></span>
    </span>
    <span class="day spacer"></span><span class="day spacer"></span>

    <span class="day" id="year_2026">
      <span class="container"><span class="number">2026</span></span>
    </span>
    <span class="day spacer"></span><span class="day spacer"></span>

    <span class="day" id="year_2027">
      <span class="container"><span class="number">2027</span></span>
    </span>
    <span class="day spacer"></span><span class="day spacer"></span>

    <span class="day" id="year_2028">
      <span class="container"><span class="number">2028</span></span>
    </span>
    <span class="day spacer"></span><span class="day spacer"></span>

    <span class="day" id="year_2029">
      <span class="container"><span class="number">2029</span></span>
    </span>
    <span class="day spacer"></span><span class="day spacer"></span>

    <span class="day" id="year_2030">
      <span class="container"><span class="number">2030</span></span>
    </span>
    <span class="day spacer"></span><span class="day spacer"></span>

    <span class="day" id="year_2031">
      <span class="container"><span class="number">2031</span></span>
    </span>
    <span class="day spacer"></span><span class="day spacer"></span>

    <span class="day" id="year_2032">
      <span class="container"><span class="number">2032</span></span>
    </span>
    <span class="day spacer"></span><span class="day spacer"></span>

    <span class="day" id="year_2033">
      <span class="container"><span class="number">2033</span></span>
    </span>
    <span class="day spacer"></span><span class="day spacer"></span>

    <span class="day" id="year_2034">
      <span class="container"><span class="number">2034</span></span>
    </span>
  </div>

  <!-- Timeline Marker -->
  <div id="date-marker" class="date-marker active"></div>
  
  <div id="timeline-separator"></div>

  <!-- Date Meter -->
  <div id="date-meter" class="date-meter">
    <div class="title">Year</div>
    <div class="date"><<= $year || 1 >></div>
    <div class="days-total">/10</div>
  </div>
 <div class="balance-meter" id="balance-meter" data-unit="currency" style="top: 0px">
    <div class="title">Budget</div>
    <div class="balance">
      <span class="dollar-sign">$</span>
      <span class="digits" id="budget-val">100</span>
            <span class="million">M</span>
    </div>
  </div>

  <!-- Public Opinion -->
  <div class="balance-meter" id="balance-meter"  data-unit="currency"  style="top: 100px">
    <div class="title">Public Opinion</div>
    <div class="balance">
      <span class="emoji" id="public-opinion-emoji">•_•</span>
    </div>
  </div>

  <!-- Service Coordination (slider) -->
  <div class="balance-meter" id="balance-meter"  data-unit="bar"  style="top: 200px">
    <div class="title">Service Coordination</div>
    <div class="balance">
      <div class="bar-container">
        <div class="bar-fill" id="coordination-bar"></div>
      </div>
    </div>
  </div>

  <!-- System Capacity -->
  <div class="balance-meter" id="balance-meter"  data-unit="percent"  style="top: 320px">
    <div class="title">System Capacity</div>
    <div class="balance">
      <span class="unit">%</span>
      <span class="digits" id="capacity-val">20</span>
    </div>
  </div>

  <!-- Political Capital (dots) -->
  <div class="balance-meter"id="balance-meter"   data-unit="dots" style="top: 440px">
    <div class="title">Political Capital</div>
    <div class="circles">
      <span class="circle" data-index="1"></span>
      <span class="circle" data-index="2"></span>
      <span class="circle" data-index="3"></span>
      <span class="circle" data-index="4"></span>
    </div>
  </div>

  <!--  =====  END UI  =====  -->


:: StoryScript [script]
importScripts(
"https://cdn.jsdelivr.net/npm/chart.js@4.4.9/dist/chart.umd.min.js",
  "https://cdn.jsdelivr.net/npm/motion@latest/dist/motion.js",
  "https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"
);


/* === 🧠 UTILITIES & POLICY LOGIC === */
window.Util = {
  renorm(obj) {
    const total = Object.values(obj).reduce((a,b)=>a+b,0);
    Object.keys(obj).forEach(k => obj[k] = +(obj[k]/total).toFixed(4));
  },
  exitPeople(n, shares = null, filterFn = () => true) {
    const v = State.variables;
    let remaining = n;
    const eligible = Object.entries(v.pop)
      .filter(([k,c]) => filterFn(k) && c > 0)
      .reduce((o,[k,c]) => (o[k] = c, o), {});
    if (!shares) shares = { ...eligible };
    else Object.keys(shares).forEach(k => { if (!eligible[k]) delete shares[k]; });

    const totalPop = Object.values(eligible).reduce((a,b) => a + b, 0);
    const weighted = {};
    Object.entries(eligible).forEach(([k,c]) => {
      weighted[k] = (c / totalPop) * (shares[k] ?? 1);
    });
    this.renorm(weighted);

    Object.entries(weighted).forEach(([k, share]) => {
      const target = Math.min(Math.round(n * share), v.pop[k]);
      const actual = Math.min(target, remaining);
      v.pop[k] -= actual;
      v.homelessTotal -= actual;
      remaining -= actual;
    });
  }
};

window.PolicyManager = {
  active: [],
  register(cfg) {
    const p = Object.assign({
      age: 0,
      duration: Infinity,
      costUpfront: 0,
      costPerTurn: 0,
      immediate() {},
      tick() {},
    }, cfg);
    State.variables.budget -= p.costUpfront;
    p.immediate(State.variables, Util);
    this.active.push(p);
    if (typeof updateUI === 'function') updateUI();
  },
  tick() {
    const v = State.variables;
    this.active = this.active.filter(p => {
      p.age++;
      v.budget -= p.costPerTurn;
      p.tick(v, Util, p.age);
      return p.age < p.duration;
    });

    const arrivals = v.inflowBase;
    for (const [demo, share] of Object.entries(v.inflowShare)) {
      const num = Math.round(arrivals * share);
      v.pop[demo] = (v.pop[demo] || 0) + num;
      v.homelessTotal += num;
    }
    
    if (!Array.isArray(v.history)) {
      // console.warn("PolicyManager.tick(): Initializing v.history as it was not an array."); // Optional: for debugging
      v.history = [];
    }
    
// Deep copy $pop for the snapshot
    const popSnapshot = {};
    for (const key in v.pop) {
        if (Object.prototype.hasOwnProperty.call(v.pop, key)) {
            popSnapshot[key] = v.pop[key];
        }
    }
    const snapshot = {
      year: v.year, // Current year value after any increments for this period
      turn: v.turn, // Current turn value
      homelessTotal: v.homelessTotal,
      pop: popSnapshot,
      budget: v.budget,
      publicOpinion: v.publicOpinion,
      serviceCoordination: v.serviceCoordination,
      systemCapacity: v.systemCapacity,
      politicalCapital: v.politicalCapital
    };
    v.history.push(snapshot);
    // === HISTORY SNAPSHOT END ===
    if (typeof updateUI === 'function') updateUI();
  }
};
function updateTimeline() {
  const v = State.variables;

  // 1️⃣ Map your logical year index → real year
  const yearIndex  = v.year || (v.year = 1);        // 1-based
  const displayYear = v.year;       // e.g. 1 → 2024

  // 2️⃣ Highlight the current year
  $('#timeline .year').removeClass('active');
  $(`#year_${displayYear}`).addClass('active');

  // 3️⃣ Move the date marker
  const $t = $(`#year_${displayYear}`);
  if ($t.length) {
    $('#date-marker').css({
      top:  $t.position().top,
      left: $t.position().left
    });
  }

  // 4️⃣ Update the text
  $('.date-meter .date').text(displayYear);

  // 5️⃣ Compute fractional progress through the year
  const turnsPerYear = 5;                          // 1/5th per turn
  const turn        = v.turn || 1;                 // assume v.turn increments
  const turnInYear  = (turn - 1) % turnsPerYear;    // 0,1,2,3,4
  const fraction    = turnInYear / turnsPerYear;    // 0.0 → 0.8

  // 6️⃣ Compute total fractional years since 2024
  const minYear     = 2024;
  const maxYear     = 2034;
  const totalYears  = maxYear - minYear;           // e.g. 10
  const yearsOffset = (yearIndex - 1) + fraction;   // e.g. 2.4 years into plan

  // 7️⃣ Convert to percentage
  let pct = (yearsOffset / totalYears) * 100;
  pct = Math.min(100, pct);                         // clamp at 100%

  // 8️⃣ Apply to CSS variable
  const el = document.getElementById('timeline');
  if (el) {
    el.style.setProperty('--tl-progress', pct + '%');
  }
}
$(window).on('load', updateTimeline);
$(document).on(':passagestart :passagedisplay', updateTimeline);
updateTimeline();

function pickOpinionFace(val) {
  if (val < 20)      return 'ヽ(ಠ‸ಠ)ﾉ';   // super-mad
  else if (val < 40) return '•`_´•';     // mad
  else if (val < 60) return '•_•';       // neutral
  else if (val < 80) return '^_^';       // happy
  else               return 'ᕕ(ᐛ)ᕗ';  // very happy
}



/* === 📊 UI METRIC UPDATER (STATIC + ANIMATED) === */
function staticUIUpdater() {
  const v = State.variables;

  // 💸 Budget
  document.getElementById('budget-val').textContent = (v.budget || 0).toLocaleString();

  // 🔋 System Capacity
  document.getElementById('capacity-val').textContent = v.systemCapacity ?? '--';

  // 📊 Service Coordination Bar
  const bar = document.getElementById('coordination-bar');
  const pct = Math.max(0, Math.min(v.serviceCoordination || 0, 100));
  if (window.innerWidth <= 979) {
    bar.style.height = pct + '%';
    bar.style.width  = '100%';
  } else {
    bar.style.width  = pct + '%';
    bar.style.height = '100%';
  }

    const popVal = v.publicOpinion || 0;

    document.getElementById('public-opinion-emoji').textContent = pickOpinionFace(popVal);

  
  // 🟢 Political Capital Dots
  const pc = v.politicalCapital || 0;
  document.querySelectorAll('.balance-meter .circle').forEach(circle => {
    const i = parseInt(circle.dataset.index, 10);
    circle.classList.toggle('filled', i <= pc);
  });
}

let animateUIUpdater = null;

function updateUI() {
  if (animateUIUpdater) animateUIUpdater();
  else staticUIUpdater();
}

$(window).on('load', updateUI);
$(document).on(':passagestart :passagedisplay', () => setTimeout(updateUI, 0));
$(window).on('resize', updateUI);


/* === ⚡ ANIMATE UI METRICS WITH MOTION.JS === */
$.getScript('https://cdn.jsdelivr.net/npm/motion@latest/dist/motion.js')
  .done(() => {
    const animate = Motion.animate;

    animateUIUpdater = function() {
      const v = State.variables;

      // 💸 Budget
      const elB = document.getElementById('budget-val');
      const oldB = parseInt(elB.textContent.replace(/,/g,''), 10) || 0;
      const newB = v.budget || 0;
      animate(oldB, newB, {
        duration: 0.5, ease: 'circOut',
        onUpdate(x) {
          elB.textContent = Math.round(x).toLocaleString();
        }
      });

      // 🔋 System Capacity
      const elC = document.getElementById('capacity-val');
      const oldC = parseInt(elC.textContent, 10) || 0;
      const newC = v.systemCapacity || 0;
      animate(oldC, newC, {
        duration: 0.5, ease: 'circOut',
        onUpdate(x) {
          elC.textContent = Math.round(x);
        }
      });

      const popVal = v.publicOpinion || 0;

    document.getElementById('public-opinion-emoji').textContent = pickOpinionFace(popVal);
      
      // 📊 Service Coordination Bar (responsive)
      const bar = document.getElementById('coordination-bar');
      const isMobile = window.innerWidth <= 979;
      const prop     = isMobile ? 'height' : 'width';
      const oldPct   = parseFloat(bar.style[prop]) || 0;
      const pct      = Math.max(0, Math.min(v.serviceCoordination || 0, 100));

      animate(oldPct, pct, {
        duration: 0.5,
        onUpdate(x) {
          if (isMobile) {
            bar.style.height = x + '%';
            bar.style.width  = '100%';
          } else {
            bar.style.width  = x + '%';
            bar.style.height = '100%';
          }
        }
      });

      // 🟢 Political Capital (non-animated)
      const pc = v.politicalCapital || 0;
      document.querySelectorAll('.balance-meter .circle').forEach(circle => {
        const i = parseInt(circle.dataset.index, 10);
        circle.classList.toggle('filled', i <= pc);
      });
    };

    updateUI(); // initial animated run
  })
  .fail(() => {
    console.warn('⚠️ Motion.js failed to load. Falling back to static UI updates.');
  });

$.getScript('https://cdn.jsdelivr.net/npm/motion@latest/dist/motion.js')
  .done(() => {
    $(document).on(':passagedisplay', () => {
      document.querySelectorAll('.animated-box').forEach(box => {
        // Initial style for animation
        Object.assign(box.style, {
          backgroundColor: '#3498db',
          color:           '#fff',
          borderRadius:    '12px',
          padding:         '1em',
          display:         'inline-block',
          opacity:         '0',
          transform:       'scale(0.8)',
        });

        // Animate in
        Motion.animate(
          box,
          { opacity: [0, 1], scale: [0.8, 1] },
          { duration: 0.6, easing: 'ease-in-out' }
        );
      });
    });
  })
  .fail(() => {
    console.warn('⚠️ Motion.js failed to load.');
  });

/* === 📱 MOBILE TOOLTIP SUPPORT === */
$(function() {
  $(document).on('click', '.balance-meter', function() {
    if (window.innerWidth > 979) return;
    const $m = $(this), name = $m.find('.title').text().trim();
    $m.find('.tooltip').remove();
    const $tip = $('<div class="tooltip"></div>').text(name).appendTo($m);
    requestAnimationFrame(() => $tip.css({ opacity: 1, pointerEvents: 'auto' }));
    setTimeout(() => {
      $tip.css('opacity', 0);
      setTimeout(() => $tip.remove(), 250);
    }, 2500);
  });
});


:: StoryStylesheet [stylesheet]
@import url("https://fonts.googleapis.com/css2?family=Geist+Mono:wght@100..900&family=Inter:wght@100..900&family=Spectral:wght@200;400;600;800&display=swap");

@import url('https://fonts.googleapis.com/css2?family=Domine:wght@400..700&display=swap');

@import url("https://cdn.jsdelivr.net/npm/charts.css/dist/charts.min.css");
@import url("https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css");


.million {
  font-size: 24px;
  margin-left: -.5em;
}
#public-opinion-emoji {
  font-family: Inter, sans-serif;
  font-size: 1.1em;
  line-height: 1;
  display: inline-block;
  margin-left: 8px;
}


/* ----------  MOBILE ≤640px  ---------- */
@media (max-width: 979px) {
  /* Prevent any wrapping of currency text */
  .balance-meter .balance {
    white-space: nowrap;
  }

  /* Prevent digits and unit glyph wrapping */
  .balance-meter .digits,
  .balance-meter .dollar-sign,
  .balance-meter .unit {
    white-space: nowrap;
  }
  .balance-meter .circle {
    width: 2.5vw !important;
    height: 2.5vw !important;
  }
  /* 2×2 grid for political capital dots */
  .balance-meter[data-unit="dots"] .circles {
    display: grid;
    grid-template-columns: repeat(2, auto);
    gap: 0.6em;
    justify-content: center;
    width: fit-content;
    margin: 0.6em auto 0;
  }
}

/* 1×4 layout at narrower viewports */
@media (max-width: 500px) {
  .balance-meter[data-unit="dots"] .circles {
    grid-template-columns: repeat(4, auto);
  }
}
/* ----------  END MOBILE  ---------- */
/* track/container lives inside .balance */
.balance-meter .balance .bar-container {
  background-color: #ddd;
  border-radius: 999px;
  overflow: hidden;
  height: 0.5em;
  margin-top: 0.4em;
  width: 100%; /* fill the same column width */
}

/* the blue fill: default to 50%, transitions nicely */
.balance-meter .balance .bar-fill {
  background-color: #0066cc;
  height: 100%;
  width: 50%;
  border-radius: 999px;
  transition: width 0.3s ease, height 0.3s ease;
}

/* Responsive orientation for bar sliders */
@media (max-width: 979px) {
  .balance-meter[data-unit="bar"] .bar-container {
    /* swap dimensions for vertical mode */
    width: 0.5em;
    height: 8rem; /* adjust as needed for visibility */
    display: flex;
    margin-right: 0.4em;
    margin-top: 0;
    position: relative;
    top: -2.5rem;
    margin-bottom: 0.5em;
    align-items: flex-end;
  }
  .balance-meter[data-unit="bar"] .bar-fill {
    /* fill vertically */
    width: 100% !important;
  }
  .balance-meter[data-unit="dots"] {
    top: 25rem !important;
  }
}

/* container flexes circles side by side */
.balance-meter .circles {
  display: flex;
  gap: 0.8em;
  margin-top: 0.4em;
}

/* each circle: grey default */
.balance-meter .circle {
  width: 1.5vw;
  height: 1.5vw;
  border-radius: 50%;
  background-color: #ccc;
  transition: background-color 0.2s;
}

/* “active” (blue) state */
.balance-meter .circle.filled {
  background-color: #0066cc;
}

/* Default font for passages */
.passage,
.passageContent {
  font-family: "Inter", sans-serif;
}

br {
  display: none;
}
#balance-meter {
  left: calc(5px + 1%) !important;
  left: -webkit-calc(5px + 1%) !important;
}

#timeline .day {
  font-family: "Spectral", serif !important;
  font-weight: 400;
}
/* Use Spectral for all monetary values and timeline year markers */
.balance-meter .balance,
.balance-meter .digits,
.balance-meter .dollar-sign,
.date-meter .date,
.day.spacer,
.days-total timeline,
span.day.spacer,
.money {
  font-family: "Spectral", serif !important;
  font-weight: 600;
}

.passage {
  margin-left: auto !important;
  margin-right: auto !important;
  width: 65% !important;
}

@media (max-width: 979px) {
  .passage {
    width: 50% !important;
  }
}

.passageContent {
  margin-top: 10rem; /* shift down */
  margin-bottom: 4rem;
}

body,
html {
  margin: 0;
  padding: 0 !important;
  position: relative;
}
body * {
  box-sizing: border-box;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  -ms-box-sizing: border-box;
  -o-box-sizing: border-box;
}
\::-moz-selection,
\::selection {
  background: #eee;
  text-shadow: none;
}
a {
  text-decoration: none;
}
svg {
  vertical-align: middle;
}
menu {
  margin: 0;
  padding: 0;
}
html {
  background-image: url(../images/icons/icons.svg) no-repeat -9999px -9999px;
  height: 100%;
  width: 100%;
}
html * {
  -webkit-font-smoothing: antialiased;
}
html .android_false * {
  text-rendering: optimizeLegibility;
}
html.touch * {
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
}

body {
  background-color: #ffffff;
  color: #1a1a1a;
  font-family: adobe-caslon-pro, Georgia, Times, serif;
  height: auto;
  min-height: 100%;
  width: 100%;
  overflow-x: hidden;
  overflow-y: hidden;
}
body .wrap {
  height: 100%;
  width: 100%;
  overflow: hidden;
  position: absolute;
  left: 0;
  top: 0;
}
@media (min-width: 980px) {
  body {
    height: 100%;
    min-height: 644px;
    overflow-x: hidden;
    overflow-y: auto;
    position: relative;
  }
}
.left {
  float: left;
}
.clear {
  clear: both;
}
.tooltip {
  background-color: #0066cc;
  color: #ffffff;
  font-size: 16px;
  font-family: "Inter", sans-serif;
  letter-spacing: 0.05em;
  line-height: 1;
  opacity: 0;
  position: relative;
  padding: 10px 10px 8px;
  pointer-events: none;
  position: absolute;
  left: 0;
  margin-top: 10px;
  text-transform: uppercase;
  top: 100%;
  white-space: nowrap;
  z-index: 999;
  -webkit-transition: opacity 0.2s linear;
  -moz-transition: opacity 0.2s linear;
  transition: opacity 0.2s linear;
}
.tooltip:before {
  border-left: 5px solid transparent;
  border-right: 5px solid transparent;
  border-bottom: 5px solid #0066cc;
  content: "";
  left: 14px;
  position: absolute;
  top: -5px;
}
.crosser {
  position: relative;
}
#welcome {
  background-color: #151a1e;
  font-family: "Inter", Helvetica, Arial, sans-serif;
  letter-spacing: 0.05em;
  opacity: 0;
  visibility: hidden;
  z-index: 9;
  -webkit-transition: opacity 0.5s linear;
  -moz-transition: opacity 0.5s linear;
  transition: opacity 0.5s linear;
}
#welcome.active {
  opacity: 1;
}
#welcome .container {
  text-align: center;
}
#balance-meter {
  color: 131313;
  cursor: pointer;
  font-family: "Inter", Helvetica, Arial, sans-serif;
  left: 0;
  padding: 0.4em;
  padding-top: 2em;
  position: fixed;
  top: 0;
  text-transform: uppercase;
  z-index: 7;
}
#balance-meter:after {
  border-left: 4px solid transparent;
  border-right: 4px solid transparent;
  border-top: 4px solid #0066cc;
  content: "";
  padding-top: 2em;
  margin-top: 1.4em !important;
  display: inline-block;
  height: 0;
  left: 100%;
  margin-left: 0;
  position: absolute;
  top: 22px;
  vertical-align: middle;
  width: 0;
}
#balance-meter .title {
  border-bottom: 1px dotted rgba(0, 0, 0, 0.8);
  display: none;
  font-size: 1em;
  color: #333;
  font-weight: 400;
  margin-bottom: 5px;
  padding-bottom: 5px;
}
#balance-meter .balance {
  font-size: 2em;
  letter-spacing: 0.05em;
  white-space: nowrap;
}
#balance-meter .balance .dollar-sign {
  color: #0066cc;
}
#balance-meter .balance .unit {
  color: #0066cc;
}
@media (min-width: 740px) {
  #balance-meter {
    left: 20px;
    top: 10px;
  }
  #balance-meter:after {
    border-left: 8px solid transparent;
    border-right: 8px solid transparent;
    border-top: 8px solid #0066cc;
    top: 30px;
  }
  #balance-meter .title {
    margin-bottom: 5px;
    padding-bottom: 5px;
  }
  #balance-meter .balance {
    font-size: 3em;
  }
}
@media (min-width: 980px) {
  #balance-meter {
    cursor: default;
    left: calc(75px + 1%);
    left: -webkit-calc(75px + 1%);
    text-align: left;
    top: 0;
    max-width: 200px;
    min-width: 100px;
    width: 10%;
  }
  #balance-meter:after {
    display: none;
  }
  #balance-meter .title {
    display: block;
    margin-bottom: 5px;
    padding-bottom: 5px;
  }
}

#date-meter {
  color: #131313;
  font-family: "Inter", Helvetica, Arial, sans-serif;
  right: 15px;
  padding: 0.4em;
  position: fixed;
  top: 0;
  text-transform: uppercase;
  z-index: 7;
  padding-top: 2em;
}
#date-meter .title {
  display: none;
  border-bottom: 1px dotted rgba(0, 0, 0, 0.8);
  font-size: 23px;
  letter-spacing: 0.05em;
  margin-bottom: 5px;
  padding-bottom: 5px;
}
#date-meter .date {
  display: inline-block;
  font-size: 2em;
  text-align: center;
  letter-spacing: 0.05em;
}
#date-meter .days-total {
  color: #5f5d54;
  display: inline-block;
  font-family: "Spectral", serif !important;
  font-weight: 600;
  font-size: 2em;
  letter-spacing: 0.05em;
}
@media (min-width: 740px) {
  #date-meter {
    right: 30px;
    top: 10px;
  }
  #date-meter .title {
    margin-bottom: 5px;
    padding-bottom: 5px;
  }
  #date-meter .date {
    font-size: 3em;
  }
  #date-meter .days-total {
    font-size: 3em;
  }
}
@media (min-width: 980px) {
  #date-meter {
    right: calc(75px + 1%);
    right: -webkit-calc(75px + 1%);
    top: 0;
    text-align: right;
    max-width: 200px;
    min-width: 100px;
    width: 10%;
  }
  #date-meter .title {
    display: block;
    font-size: 16px;
    margin-bottom: 5px;
    padding-bottom: 5px;
  }
  #date-meter .date {
    text-align: right;
    width: 100%;
  }
  #date-meter .days-total {
    display: none;
  }
}
@media (max-width: 979px) {
  #date-meter {
    top: 10px !important;
  }
}
@media (max-width: 739px) {
  #date-meter {
    top: 0 !important;
  }
}
#rescues {
  float: left;
  padding: 10px;
  width: 50%;
}
#rescues .rescue {
  color: #90d4c6;
  clear: both;
  cursor: pointer;
  display: block;
  font-family: "Inter", Helvetica, Arial, sans-serif;
  font-size: 15px;
  line-height: 1.4;
  position: relative;
  text-transform: uppercase;
  vertical-align: middle;
}
#rescues .rescue:hover {
  color: #90d4c6;
}
#rescues .rescue .icon {
  display: block;
  background: url(../images/icons/icons.svg) no-repeat 100px 100px;
  float: left;
  height: 57px;
  margin: 0 15px 0 0;
  vertical-align: bottom;
  width: 57px;
}
#rescues .rescue#rescue_1 .icon {
  background-position: 0 -371px;
}
#rescues .rescue#rescue_2 .icon {
  background-position: -72px -371px;
}
#rescues .rescue#rescue_3 .icon {
  background-position: -144px -371px;
}
#rescues .rescue .tooltip {
  margin-left: 67px;
}
@media (min-width: 740px) {
  #rescues .rescue {
    font-size: 22px;
    line-height: 36px;
  }
}
@media (min-width: 980px) {
  #rescues {
    float: none;
    padding: 0;
    width: 100%;
  }
  #rescues .rescue {
    margin: 10px auto;
    position: relative;
    text-align: center;
  }
  #rescues .rescue .icon {
    float: none;
    margin: 0 auto;
  }
  #rescues .rescue .tooltip {
    left: 100%;
    margin: -17px 0 0;
    top: 50%;
  }
  #rescues .rescue .tooltip:before {
    border-top: 6px solid transparent;
    border-bottom: 6px solid transparent;
    border-right: 6px solid #90d4c6;
    content: "";
    left: -11px;
    margin-top: -6px;
    position: absolute;
    top: 50%;
  }
  #rescues .rescue:hover .tooltip {
    opacity: 1;
  }
}
@media (max-width: 979px) {
  #rescues {
    border-right: 1px solid #5f5d54;
    height: 100%;
    padding: 0 25px 0 10px;
  }
  #rescues .title {
    font-size: 28px;
    text-align: center;
  }
  #rescues .rescue {
    border-bottom: 1px solid #5f5d54;
    padding: 25px 0;
    width: 100%;
  }
  #rescues .rescue:last-child {
    border-bottom: none;
  }
  #rescues .rescue .icon {
    float: left;
    vertical-align: middle;
  }
  #rescues .rescue .tooltip {
    background: 0 0;
    color: #90d4c6;
    display: block;
    font-size: 22px;
    line-height: 1.1;
    margin: 0;
    opacity: 1;
    overflow: hidden;
    padding: 0;
    position: static;
    vertical-align: middle;
    white-space: normal;
  }
  #rescues .rescue .tooltip:before {
    display: none;
  }
  #rescues .rescue:after,
  #rescues .rescue:before {
    left: -10px;
    height: 80px;
    width: 80px;
    margin-top: 0;
    top: 55px;
  }
}
@media (max-width: 739px) {
  #rescues {
    padding: 0 10px;
  }
  #rescues .title {
    font-size: 20px;
    margin: 0;
  }
  #rescues .rescue {
    margin: 0;
    padding: 12px 0;
  }
  #rescues .rescue .icon {
    background-size: 480px 300px;
    height: 34px;
    width: 34px;
  }
  #rescues .rescue#rescue_1 .icon {
    background-position: 0 -223px;
  }
  #rescues .rescue#rescue_2 .icon {
    background-position: -43px -223px;
  }
  #rescues .rescue#rescue_3 .icon {
    background-position: -86px -223px;
  }
  #rescues .rescue .tooltip {
    font-size: 16px;
  }
  #rescues .rescue:after,
  #rescues .rescue:before {
    left: -7px;
    height: 50px;
    width: 50px;
    margin-top: 0;
    top: 28px;
  }
}
#job-strikes {
  display: none;
  float: right;
  padding: 10px;
  width: 100%;
}
#job-strikes.no-job {
  opacity: 0.3;
}
#job-strikes .job-strike {
  font-size: 80px;
  line-height: 1;
  opacity: 0.2;
}
#job-strikes .job-strike.active {
  color: #0066cc;
  opacity: 1;
}
@media (min-width: 980px) {
  #job-strikes {
    display: block;
    float: none;
    width: 100%;
  }
  #job-strikes .job-strike {
    line-height: 0.7;
    text-align: center;
  }
}
#timeline {
  height: 100%;
  padding: 20px 0;
  pointer-events: none;
  right: -44px;
  position: fixed;
  top: 0;
  width: 20px;
  z-index: 3;
}
#timeline.active {
  right: 0;
}
#timeline .day {
  font-family: "Inter", Helvetica, Arial, sans-serif;
  height: 3.2258065%;
  display: block;
  text-align: center;
  width: 100%;
}
#timeline .day.active .number {
  color: 131313;
}
#timeline .day.active .payday {
  color: #0066cc;
}
#timeline .day .container {
  color: #5f5d54;
  vertical-align: middle;
  position: relative;
  text-align: center;
}
#timeline .day .container .payday {
  left: -14px;
  position: absolute;
  text-align: left;
  top: 0;
  width: 20px;
}
@media (min-width: 740px) {
  #timeline {
    width: 36px;
  }
}
@media (min-width: 980px) {
  #timeline {
    background: #fcfcfc;
    position: fixed;
    width: 75px;
  }
  #timeline .day#day_final .container {
    background-color: #0066cc;
    color: #ffffff;
    border-radius: 100%;
    color: #151a1e;
    display: block;
    height: 30px;
    line-height: 31px;
    margin: 0 auto;
    width: 30px;
  }
}
@media (max-width: 979px) {
  #timeline {
    padding-bottom: 0;
  }
  #timeline .day {
    position: relative;
  }
  #timeline .day .container {
    position: static;
  }
  #timeline .day .container:before {
    background-color: #5f5d54;
    border-radius: 100%;
    content: "";
    display: inline-block;
    height: 6px;
    margin: 0 auto;
    width: 6px;
    position: absolute;
    top: 0;
    left: 50%;
  }
  #timeline .day .container .number {
    visibility: hidden;
  }
  #timeline .day .container .payday {
    left: -5px;
    top: -5px;
  }
  #timeline .day.active .container:before {
    background-color: #1a1a1a;
  }
  #timeline .day#day_final .container {
    color: transparent;
  }
  #timeline .day#day_final .container:before {
    background-color: #0066cc;
  }
}
@media (max-width: 739px) {
  #timeline .day .container .payday {
    left: -2px;
  }
}
#toolbox {
  background-color: #fcfcfc;
  height: 100%;
  padding-top: 50px;
  position: fixed;
  top: 0;
  width: 100%;
  z-index: 6;
}
#toolbox .title {
  display: block;
  font-family: "Inter", Helvetica, Arial, sans-serif;
  text-transform: uppercase;
}
#toolbox .volume {
  cursor: pointer;
  background: url(../images/icons/icons.svg) no-repeat -718px -108px;
  border-radius: 100%;
  height: 57px;
  position: relative;
  width: 57px;
}
@media (min-width: 740px) {
  #toolbox {
    padding: 80px 15px 0 15px;
  }
}
@media (min-width: 980px) {
  #toolbox {
    background-color: #fcfcfc;
    bottom: auto;
    height: 100%;
    left: 0;
    padding: 0;
    width: 75px;
    z-index: 7;
  }
  #toolbox .container {
    bottom: 0;
    position: absolute;
  }
  #toolbox .title {
    display: block;
    font-family: "Inter", Helvetica, Arial, sans-serif;
    font-size: 1em;
    margin: 0 auto 20px auto;
    text-align: center;
    width: 80%;
  }
  #toolbox .volume {
    margin: 20px auto;
  }
}
@media (max-width: 979px) {
  #toolbox {
    padding-top: 90px;
    -webkit-transition: -webkit-transform 0.25s ease-in-out;
    transition: transform 0.25s ease-in-out;
    -webkit-transform: translateY(-100%);
    transform: translateY(-100%);
  }
  #toolbox.active {
    -webkit-transform: translateY(0);
    transform: translateY(0);
  }
  #toolbox:after {
    background: -moz-linear-gradient(top, rgba(32, 35, 38, 0) 0, #fcfcfc 90%);
    background: -webkit-gradient(
      linear,
      left top,
      left bottom,
      color-stop(0, rgba(32, 35, 38, 0)),
      color-stop(90%, #fcfcfc)
    );
    background: -webkit-linear-gradient(
      top,
      rgba(32, 35, 38, 0) 0,
      #fcfcfc 90%
    );
    background: -o-linear-gradient(top, rgba(32, 35, 38, 0) 0, #fcfcfc 90%);
    background: -ms-linear-gradient(top, rgba(32, 35, 38, 0) 0, #fcfcfc 90%);
    background: linear-gradient(to bottom, rgba(32, 35, 38, 0) 0, #fcfcfc 90%);
    bottom: 0;
    content: "";
    display: block;
    height: 80px;
    left: 0;
    position: absolute;
    width: 100%;
  }
  #toolbox .container {
    height: 100%;
    position: relative;
  }
  #toolbox .volume {
    top: -75px;
    left: 50%;
    margin: 0 0 80px -28px;
    position: absolute;
  }
}
@media (max-width: 739px) {
  #toolbox {
    padding-top: 60px;
  }
  #toolbox:after {
    height: 50px;
  }
  #toolbox .volume {
    margin-left: -17px;
    top: -52px;
    background-size: 480px 300px;
    height: 34px;
    width: 34px;
    background-position: -431px -65px;
  }
}
#unresolves-menu {
  position: absolute;
  top: 0;
  z-index: 2;
}
#unresolves-menu .title {
  display: inline-block;
}
#unresolves-menu .container {
  display: inline-block;
  position: static;
}
@media (min-width: 980px) {
  #unresolves-menu {
    left: 85px;
    top: 0;
    width: 96px;
  }
  #unresolves-menu .title {
    display: none;
  }
  #unresolves-menu .container {
    position: relative;
  }
}
@media (max-width: 979px) {
  #unresolves-menu {
    left: 50% !important;
    top: 90px !important;
    height: calc(100% - 90px);
    width: 50%;
  }
  #unresolves-menu .title {
    display: block;
    margin-bottom: 0;
    font-size: 28px;
    text-align: center;
    width: 100%;
  }
  #unresolves-menu .container {
    display: block;
    height: calc(100% - 48px);
    overflow-y: auto;
    overflow-x: hidden;
    padding: 0 25px;
  }
}
@media (max-width: 739px) {
  #unresolves-menu {
    height: calc(100% - 60px);
    top: 60px !important;
  }
  #unresolves-menu .title {
    font-size: 20px;
    margin: 0;
  }
  #unresolves-menu .container {
    height: calc(100% - 24px);
    padding: 0 10px;
  }
}
#content {
  font-family: "Inter", Helvetica, Arial, sans-serif;
  height: 100%;
  left: 0;
  position: absolute;
  top: 0;
  width: 100%;
  z-index: 4;
}

#timeline::after {
  content: "";
  position: absolute;
  top: 0;
  width: 4px;
  height: var(--tl-progress, 0%);
  background-color: #0066cc;
  transition: height 0.5s ease;
  pointer-events: none;
  z-index: 5;
}
/* Hide on small screens */
@media (max-width: 979px) {
  #timeline::before {
    display: none;
  }
}
/* Only offset for vertical bar sliders (mobile layout) */
@media (max-width: 979px) {
  .balance-meter[data-unit="bar"] .tooltip {
    top: calc(100% - 5rem);
  }
  body {
    overflow-y: auto;
  }
}
